var chitu;(function(n){var t=n.Errors,i=function(){function n(){}return n.isType=function(n,t){for(var i in n.prototype)if(t[i]===undefined)return!1;return!0},n.isDeferred=function(n){return n==null?!1:n.pipe!=null&&n.always!=null&&n.done!=null?!0:!1},n.format=function(n,t){return arguments.length>2&&t.constructor!==Array&&(t=$.makeArray(arguments).slice(1)),t.constructor!==Array&&(t=[t]),$.each(t,function(t,i){n=n.replace(new RegExp("\\{"+t+"\\}","g"),function(){return i})}),n},n.fileName=function(n,i){var r,u;if(!n)throw t.argumentNull("url");return i=i||!0,n=n.replace("http://","/"),r=n.replace(/^.*[\\\/]/,""),i===!0&&(u=r.split("."),r=u[0]),r},n.log=function(n,t){if(t===void 0&&(t=[]),window.console){if(t==null){console.log(n);return}var i=this.format.apply(this,arguments);console.log(i)}},n}();n.Utility=i})(chitu||(chitu={})),function(n){var t=n.Utility,i=function(){function n(){}return n.argumentNull=function(n){var i=t.format('The argument "{0}" cannt be null.',[n]);return new Error(i)},n.modelFileExpecteFunction=function(n){var i=t.format('The eval result of script file "{0}" is expected a function.',n);return new Error(i)},n.paramTypeError=function(n,i){var r=t.format('The param "{0}" is expected "{1}" type.',[n,i]);return new Error(r)},n.viewNodeNotExists=function(n){var i=t.format('The view node "{0}" is not exists.',n);return new Error(i)},n.pathPairRequireView=function(n){var i=t.format('The view value is required for path pair, but the item with index "{0}" is miss it.',n);return new Error(i)},n.notImplemented=function(n){var i=t.format('The method "{0}" is not implemented.',n);return new Error(i)},n.routeExists=function(n){var i=t.format('Route named "{0}" is exists.',n);return new Error(i)},n.routeResultRequireController=function(n){var i=t.format('The parse result of route "{0}" does not contains controler.',n);return new Error(i)},n.routeResultRequireAction=function(n){var i=t.format('The parse result of route "{0}" does not contains action.',n);return new Error(i)},n.ambiguityRouteMatched=function(n,i,r){var u=t.format("Ambiguity route matched, {0} is match in {1} and {2}.",[n,i,r]);return new Error(u)},n.noneRouteMatched=function(n){var i=t.format('None route matched with url "{0}".',n);return new Error(i)},n.emptyStack=function(){return new Error("The stack is empty.")},n.canntParseUrl=function(n){var i=t.format('Can not parse the url "{0}" to route data.',[n]);return new Error(i)},n.routeDataRequireController=function(){return new Error('The route data does not contains a "controller" file.')},n.routeDataRequireAction=function(){return new Error('The route data does not contains a "action" file.')},n.parameterRequireField=function(n,i){var r=t.format("Parameter {1} does not contains field {0}.",[n,i]);return new Error(r)},n}();n.Errors=i}(chitu||(chitu={})),function(n){function u(n){var t=i[n]={};return jQuery.each(n.match(r)||[],function(n,i){t[i]=!0}),t}function e(t){t===void 0&&(t=null);t=typeof t=="string"?i[t]||u(t):jQuery.extend({},t);var e,l,h,a,o,s,r=[],f=!t.once&&[],v=function(n){for(e=t.memory&&n,l=!0,s=a||0,a=0,o=r.length,h=!0;r&&s<o;s++){var i=r[s].apply(n[0],n[1]);if(i!=null&&n[0].results.push(i),i===!1&&t.stopOnFalse){e=!1;break}}h=!1;r&&(f?f.length&&v(f.shift()):e?r=[]:c.disable())},c={results:[],add:function(){if(r){var n=r.length;(function i(n){jQuery.each(n,function(n,u){var f=jQuery.type(u);f==="function"?t.unique&&c.has(u)||r.push(u):u&&u.length&&f!=="string"&&i(u)})})(arguments);h?o=r.length:e&&(a=n,v(e))}return this},remove:function(){return r&&jQuery.each(arguments,function(n,t){for(var i;(i=jQuery.inArray(t,r,i))>-1;)r.splice(i,1),h&&(i<=o&&o--,i<=s&&s--)}),this},has:function(n){return n?jQuery.inArray(n,r)>-1:!!(r&&r.length)},empty:function(){return r=[],o=0,this},disable:function(){return r=f=e=undefined,this},disabled:function(){return!r},lock:function(){return f=undefined,e||c.disable(),this},locked:function(){return!f},fireWith:function(n,t){return n.results=[],r&&(!l||f)&&(t=t||[],t=[n,t.slice?t.slice():t],h?f.push(t):v(t)),n.results},fire:function(){return c.fireWith(this,arguments)},fired:function(){return!!l},count:function(){return r.length}};return new n.Callback(c)}function o(t,i){for(var u=t.fire(i),f=[],r=0;r<u.length;r++)n.Utility.isDeferred(u[r])&&f.push(u[r]);return f.length==0?$.Deferred().resolve():$.when.apply($,f)}var r=/\S+/g,i={},f=function(){function n(n){this.source=n}return n.prototype.add=function(n){this.source.add(n)},n.prototype.remove=function(n){this.source.remove(n)},n.prototype.has=function(n){return this.source.has(n)},n.prototype.fireWith=function(n,t){return this.source.fireWith(n,t)},n.prototype.fire=function(n){return this.source.fire(n)},n}(),t;n.Callback=f;n.callbacks=e;n.fireCallback=o;t=window.crossroads;$.extend(t,{_create:t.create,create:function(){var t=this._create();return t.getRouteData=function(t,i){if(t=t||"",i=i||[],this.ignoreState||t!==this._prevMatchedRequest&&t!==this._prevBypassedRequest){var r=this._getMatchedRoutes(t),u=r.length;if(u==0)return null;if(u>1)throw n.Errors.ambiguityRouteMatched(t,"route1","route2");return r[0]}},t}})}(chitu||(chitu={})),function(n){var t=n,i=n.Errors,r=function(){function n(n,i){this.pageCreating=t.callbacks();this.pageCreated=t.callbacks();this.pageShowing=t.callbacks();this.pageShown=t.callbacks();this.init(n,i)}return n.prototype.init=function(n,t){this._app=n;this._node=t;this._pageStack=[]},n.prototype.on_pageCreating=function(n){return t.fireCallback(this.pageCreating,[this,n])},n.prototype.on_pageCreated=function(n){return t.fireCallback(this.pageCreated,[this,n])},n.prototype.on_pageShowing=function(n,i){return t.fireCallback(this.pageShowing,[this,n,i])},n.prototype.on_pageShown=function(n,i){return t.fireCallback(this.pageShown,[this,n,i])},n.prototype.application=function(){return this._app},n.prototype.node=function(){return this._node},n.prototype.currentPage=function(){return this._currentPage},n.prototype._createPage=function(n,r){var u,f;if(!n)throw i.argumentNull("url");if(typeof n!="string")throw i.paramTypeError("url","String");if(r||(r=document.createElement("div"),document.body.appendChild(r)),u=this.application().routes().getRouteData(n),u==null)throw i.noneRouteMatched(n);var h=u.controller,c=u.action,o=this.application().controller(u),s=this.application().viewFactory.view(u),e=new t.ControllerContext(o,s,u);this.on_pageCreating(e);f=new t.Page(e,r);this.on_pageCreated(f);return f},n.prototype.showPage=function(n,t){var f,r,l,h,e,o;if(t=t||{},!n)throw i.argumentNull("url");if(f=this.application().routes().getRouteData(n),f==null)throw i.noneRouteMatched(n);var s=this.node(),a=f.controller,v=f.action,c=a+"."+v,u=$(s).data("pages");u||(u={},$(s).data("pages",u));e=this;r=u[c];r==null&&(l=$("<div>").appendTo(s)[0],r=this._createPage(n,l),u[c]=r);this._currentPage=r;for(h in u)u[h]!=this._currentPage&&u[h].visible(!1);return $.extend(t,f),e=this,o=$.Deferred(),this.on_pageShowing(r,t).pipe(function(){return r.open(t)}).done($.proxy(function(){e._pageStack.push({page:this.page,url:this.url});this.page!=e.currentPage()&&this.page.visible(!1);this.result.resolve(this.page);e.on_pageShown(this.page,t)},{page:r,result:o,url:n})).fail($.proxy(function(n){this.result.reject(this.page,n)},{page:r,result:o,url:n})),o},n.prototype.back=function(n){var i=this._pageStack,r=this.currentPage(),t,u;return i.length==0||r==null?$.Deferred().reject():(i.pop(),t=i[i.length-1],t==null)?$.Deferred().reject():(u="#"+t.url.toLowerCase(),u.localeCompare(window.location.hash.toLowerCase())!=0&&(window.location.hash=t.url,window.location.skip=!0),r.visible(!1),n?t.page.open(n):t.page.visible(!0),this._currentPage=t.page,$.Deferred().resolve())},n}();n.PageContainer=r}(chitu||(chitu={})),function(n){function i(t,i,r){return r===void 0&&(r={}),n.fireCallback(t,[i,r])}var t=n,u=n.Utility,r=n.Errors,f=function(){function n(n,i){if(this._node=HTMLElement,this._visible=!0,this._loadViewModelResult=null,this._showResult=null,this._hideResult=null,this.created=t.callbacks(),this.creating=t.callbacks(),this.preLoad=t.callbacks(),this.load=t.callbacks(),this.closing=t.callbacks(),this.closed=t.callbacks(),this.scroll=t.callbacks(),this.showing=t.callbacks(),this.shown=t.callbacks(),this.hiding=t.callbacks(),this.hidden=t.callbacks(),this._type="Page",!n)throw r.argumentNull("context");if(n._type!="ControllerContext")throw r.paramTypeError("context","ControllerContext");if(!i)throw r.argumentNull("node");this._context=n;var f=n.routeData().controller,u=n.routeData().action,e=f+"."+u,o=n.view(),s=n.controller().action(u);this.init(e,o,s,i)}return n.prototype.context=function(){return this._context},n.prototype.name=function(){return this._name},n.prototype.node=function(){return this._node},n.prototype.parent=function(){return this._parent},n.prototype.visible=function(n){var t=$(this.node()).is(":visible");if(n===undefined)return t;if(n!=t){if(n){this.on_showing({});$(this.node()).show();this.on_shown({})}else{this.on_hiding({});$(this.node()).hide();this.on_hidden({})}this._visible=n}},n.prototype.init=function(n,t,i,u){if(!n)throw r.argumentNull("name");if(!t)throw r.argumentNull("viewDeferred");if(!i)throw r.argumentNull("actionDeferred");if(!u)throw r.argumentNull("node");this._name=n;this._viewDeferred=t;this._actionDeferred=i;this._parent;this._node=u;this._visible=!0;$(this._node).hide()},n.prototype.on_creating=function(n){return i(this.creating,this,n)},n.prototype.on_created=function(){return i(this.created,this)},n.prototype.on_preLoad=function(n){return i(this.preLoad,this,n)},n.prototype.on_load=function(n){return i(this.load,this,n)},n.prototype.on_closing=function(n){return i(this.closing,this,n)},n.prototype.on_closed=function(n){return i(this.closed,this,n)},n.prototype.on_scroll=function(n){return i(this.scroll,this,n)},n.prototype.on_showing=function(n){return i(this.showing,this,n)},n.prototype.on_shown=function(n){return i(this.shown,this,n)},n.prototype.on_hiding=function(n){return i(this.hiding,this,n)},n.prototype.on_hidden=function(n){return i(this.hidden,this,n)},n.prototype._appendNode=function(n){if(n==null)throw r.argumentNull("childNode");$(this._node).append(n)},n.prototype._loadViewModel=function(){if(this._loadViewModelResult)return this._loadViewModelResult;var n=this;return this._loadViewModelResult=this._viewDeferred.pipe(function(t){return u.log("Load view success, page:{0}.",[n._name]),$(n.node()).html(t),n._actionDeferred}).pipe(function(t){var i=t.execute(n);return(n.on_created(),u.isDeferred(i))?i:$.Deferred().resolve()}).fail(function(){n._loadViewModelResult=null;u.log("Load view or action fail, page：{0}.",[n._name])}),this._loadViewModelResult},n.prototype.open=function(n){var t=this;return this._showResult=this.on_preLoad(n).pipe(function(){return t._loadViewModel()}).pipe(function(){t.on_showing(n);return t.on_load(n)}),this._showResult.done($.proxy(function(){t._hideResult=null;$(t.node()).show();t.on_shown(this.args)},{args:n})),this._showResult},n.prototype.close=function(n){var t=this;return this._hideResult||(this._hideResult=t.on_closing(n).pipe(function(){t.visible(!1);return t.on_closed(n)})),this._hideResult.always(function(){t._hideResult=null})},n}();n.Page=f}(chitu||(chitu={})),function(n){function e(n,t){var r="http://".toLowerCase(),u,i;return n.substr(0,r.length).toLowerCase()==r?(u=document.createElement("a"),u.setAttribute("href",n),n=u.pathname,i=f.addRoute(n),r+i.interpolate(t)):(i=f.addRoute(n),i.interpolate(t))}var i=n,t=i.Errors,r=i.Utility,f=window.crossroads,o=function(){function f(i,r){if(this._actions={},!i)throw t.argumentNull("routeData");if(typeof i!="object")throw t.paramTypeError("routeData","object");if(!r)throw t.argumentNull("actionLocationFormater");this._name=i.controller;this._routeData=i;this._actionLocationFormater=r;this._actions={};this.actionCreated=n.callbacks()}return f.prototype.actionLocationFormater=function(){return this._actionLocationFormater},f.prototype.name=function(){return this._name},f.prototype.getLocation=function(n){if(!n)throw t.argumentNull("actionName");if(typeof n!="string")throw t.paramTypeError("actionName","String");var i=$.extend(this._routeData,{action:n});return e(this.actionLocationFormater(),i)},f.prototype.action=function(n){if(!n)throw t.argumentNull("name");if(typeof n!="string")throw t.paramTypeError("name","String");var i=this;return this._actions[n]||(this._actions[n]=this._createAction(n).fail($.proxy(function(){i._actions[this.actionName]=null},{actionName:n}))),this._actions[n]},f.prototype._createAction=function(n){if(!n)throw t.argumentNull("actionName");var f=this,o=this.getLocation(n),e=$.Deferred();return requirejs([o],$.proxy(function(n){var t,e;if(n||(console.warn(r.format("加载活动“{1}.{0}”失败，为该活动提供默认的值。",[this.actionName,f.name()])),n={func:function(){}}),t=n.func||n,!$.isFunction(t))throw i.Errors.modelFileExpecteFunction(this.actionName);e=new u(f,this.actionName,t);f.actionCreated.fire(f,e);this.result.resolve(e)},{actionName:n,result:e}),$.proxy(function(){console.warn(r.format("加载活动“{1}.{0}”失败，为该活动提供默认的值。",[this.actionName,f.name()]));var n=new u(f,this.actionName,function(){});f.actionCreated.fire(f,n);this.result.resolve(n)},{actionName:n,result:e})),e},f}(),u;n.Controller=o;u=function(){function n(n,i,r){if(!n)throw t.argumentNull("controller");if(!i)throw t.argumentNull("name");if(!r)throw t.argumentNull("handle");if(!$.isFunction(r))throw t.paramTypeError("handle","Function");this._name=i;this._handle=r}return n.prototype.name=function(){return this._name},n.prototype.execute=function(n){if(!n)throw t.argumentNull("page");if(n._type!="Page")throw t.paramTypeError("page","Page");var i=this._handle.apply({},[n]);return r.isDeferred(i)?i:$.Deferred().resolve()},n}()}(chitu||(chitu={})),function(n){var t=function(){function n(n,t,i){this._controller=n;this._view=t;this._controller=i}return n.prototype.controller=function(){return this._controller},n.prototype.view=function(){return this._view},n.prototype.routeData=function(){return this._routeData},n}();n.ControllerContext=t}(chitu||(chitu={})),function(n){var t=n.Errors,i=n,r=function(){function n(n){if(this._controllers={},!n)throw t.argumentNull("actionLocationFormater");this._controllers={};this._actionLocationFormater=n}return n.prototype.controllers=function(){return this._controllers},n.prototype.createController=function(n){if(!n.controller)throw t.routeDataRequireController();return new i.Controller(n,n.actionPath||this.actionLocationFormater())},n.prototype.actionLocationFormater=function(){return this._actionLocationFormater},n.prototype.getController=function(n){if(typeof n!="object")throw t.paramTypeError("routeData","object");if(!n.controller)throw t.routeDataRequireController();return this._controllers[n.controller]||(this._controllers[n.controller]=this.createController(n)),this._controllers[n.controller]},n}();n.ControllerFactory=r}(chitu||(chitu={})),function(n){var i=n.utility,t=n.Error,r="{controller}/{action}",u="{controller}/{action}";n.Application=function(i){if(!i)throw t.argumentNull("func");if(!$.isFunction(i))throw t.paramTypeError("func","Function");var f={container:document.body,routes:new n.RouteCollection,actionPath:r,viewPath:u};$.proxy(i,this)(f);this.controllerFactory=new n.ControllerFactory(f.actionPath);this.viewFactory=new n.ViewFactory(f.viewPath);this._pages={};this._stack=[];this._routes=f.routes;this._container=f.container;this.pageCreating=n.Callbacks();this.pageCreated=n.Callbacks();this.pageShowing=n.Callbacks();this.pageShown=n.Callbacks()};n.Application.prototype={on_pageCreating:function(n){this.pageCreating.fire(this,n)},on_pageCreated:function(n){this.pageCreated.fire(this,n)},on_pageShowing:function(n,t){this.pageShowing.fire(this,n,t)},on_pageShown:function(n,t){this.pageShown.fire(this,n,t)},routes:function(){return this._routes},controller:function(n){if(typeof n!="object")throw t.paramTypeError("routeData","object");if(!n)throw t.argumentNull("routeData");return this.controllerFactory.getController(n)},action:function(n){var r,i,u;if(typeof n!="object")throw t.paramTypeError("routeData","object");if(!n)throw t.argumentNull("routeData");if(r=n.controller,!r)throw t.argumentNull("name");if(typeof r!="string")throw t.routeDataRequireController();if(i=n.action,!i)throw t.argumentNull("name");if(typeof i!="string")throw t.routeDataRequireAction();return u=this.controller(n),u.action(i)},run:function(){if(!this._runned){var n=this,t=function(){var t=window.location.hash,r,u;if(!t){i.log("The url is not contains hash.");return}r=window.location.arguments||{};u=window.location.container||n._container;window.location.arguments=null;window.location.container=null;(window.location.skip==null||window.location.skip==!1)&&n.showPageAt(u,t.substr(1),r);window.location.skip=!1};$.proxy(t,this)();$(window).bind("hashchange",$.proxy(t,this));this._runned=!0}},showPageAt:function(i,r,u){var f,e;if(u=u||{},!i)throw t.argumentNull("element");if(!r)throw t.argumentNull("url");return e=this,f=$(i).data("PageContainer"),f==null&&(f=new n.PageContainer(this,i),f.pageCreating.add(function(n,t){e.on_pageCreating(t)}),f.pageCreated.add(function(n,t){e.on_pageCreated(t)}),f.pageShowing.add(function(n,t,i){e.on_pageShowing(t,i)}),f.pageShown.add(function(n,t,i){e.on_pageShown(t,i)}),$(i).data("PageContainer",f)),e=this,f.showPage(r,u)},showPage:function(n,t){return this.showPageAt(this._container,n,t)},redirect:function(n,t){window.location.arguments=t;window.location.hash=n},back:function(n){var t=$(this._container).data("PageContainer");return t==null?$.Deferred().reject():t.back(n)}}}(chitu);
//# sourceMappingURL=chitu.min.js.map
