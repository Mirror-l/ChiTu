/*! Author: Shu Mai, Contact: ansiboy@163.com */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"undefined"!=typeof module&&module.exports?module.exports=a(require(["jquery"])):window.chitu=a()}(function(){function a(a){null==e&&(e=0,e=window.setInterval(function(){return d==h.scrollTop?(window.clearInterval(e),e=null,d=null,void a.on_scrollEnd(h)):void(d=h.scrollTop)},i))}var b=function(a){function b(a,b){if(a.indexOf)return a.indexOf(b);for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function c(a,c){var d=b(a,c);-1!==d&&a.splice(d,1)}function d(a,b){return"[object "+b+"]"===Object.prototype.toString.call(a)}function e(a){return d(a,"RegExp")}function f(a){return d(a,"Array")}function g(a){return"function"==typeof a}function h(a){var b;return b=null===a||"null"===a?null:"true"===a?!0:"false"===a?!1:a===o||"undefined"===a?o:""===a||isNaN(a)?a:parseFloat(a)}function i(a){for(var b=a.length,c=[];b--;)c[b]=h(a[b]);return c}function j(a,b){for(var c,d,e=(a||"").replace("?","").split("&"),f=e.length,g={};f--;)c=e[f].split("="),d=b?h(c[1]):c[1],g[c[0]]="string"==typeof d?decodeURIComponent(d):d;return g}function k(){this.bypassed=$.Callbacks(),this.routed=$.Callbacks(),this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function l(a,b,c,d){var f=e(a),g=d.patternLexer;this._router=d,this._pattern=a,this._paramsIds=f?null:g.getParamIds(a),this._optionalParamsIds=f?null:g.getOptionalParamsIds(a),this._matchRegexp=f?a:g.compilePattern(a,d.ignoreCase),this.matched=$.Callbacks(),this.switched=$.Callbacks(),b&&this.matched.add(b),this._priority=c||0}var m,n,o;return n=""===/t(.+)?/.exec("t")[1],k.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new k},addRoute:function(a,b,c){var d=new l(a,b,c,this);return this._sortedInsert(d),d},removeRoute:function(a){c(this._routes,a),a._destroy()},removeAllRoutes:function(){for(var a=this.getNumRoutes();a--;)this._routes[a]._destroy();this._routes.length=0},parse:function(a,b){if(a=a||"",b=b||[],this.ignoreState||a!==this._prevMatchedRequest&&a!==this._prevBypassedRequest){var c,d=this._getMatchedRoutes(a),e=0,f=d.length;if(f)for(this._prevMatchedRequest=a,this._notifyPrevRoutes(d,a),this._prevRoutes=d;f>e;)c=d[e],c.route.matched.fire.apply(c.route.matched,b.concat(c.params)),c.isFirst=!e,this.routed.fire.apply(this.routed,b.concat([a,c])),e+=1;else this._prevBypassedRequest=a,this.bypassed.fire.apply(this.bypassed,b.concat([a]));this._pipeParse(a,b)}},_notifyPrevRoutes:function(a,b){for(var c,d=0;c=this._prevRoutes[d++];)c.route.switched&&this._didSwitch(c.route,a)&&c.route.switched.fire(b)},_didSwitch:function(a,b){for(var c,d=0;c=b[d++];)if(c.route===a)return!1;return!0},_pipeParse:function(a,b){for(var c,d=0;c=this._piped[d++];)c.parse(a,b)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(a){var b=this._routes,c=b.length;do--c;while(b[c]&&a._priority<=b[c]._priority);b.splice(c+1,0,a)},_getMatchedRoutes:function(a){for(var b,c=[],d=this._routes,e=d.length;(b=d[--e])&&((!c.length||this.greedy||b.greedy)&&b.match(a)&&c.push({route:b,params:b._getParamsArray(a)}),this.greedyEnabled||!c.length););return c},pipe:function(a){this._piped.push(a)},unpipe:function(a){c(this._piped,a)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},m=new k,m.VERSION="0.12.0",m.NORM_AS_ARRAY=function(a,b){return[b.vals_]},m.NORM_AS_OBJECT=function(a,b){return[b]},l.prototype={greedy:!1,rules:void 0,match:function(a){return a=a||"",this._matchRegexp.test(a)&&this._validateParams(a)},_validateParams:function(a){var b,c=this.rules,d=this._getParamsObject(a);for(b in c)if("normalize_"!==b&&c.hasOwnProperty(b)&&!this._isValidParam(a,b,d))return!1;return!0},_isValidParam:function(a,c,d){var h=this.rules[c],i=d[c],j=!1,k=0===c.indexOf("?");return null==i&&this._optionalParamsIds&&-1!==b(this._optionalParamsIds,c)?j=!0:e(h)?(k&&(i=d[c+"_"]),j=h.test(i)):f(h)?(k&&(i=d[c+"_"]),j=this._isValidArrayRule(h,i)):g(h)&&(j=h(i,a,d)),j},_isValidArrayRule:function(a,c){if(!this._router.ignoreCase)return-1!==b(a,c);"string"==typeof c&&(c=c.toLowerCase());for(var d,e,f=a.length;f--;)if(d=a[f],e="string"==typeof d?d.toLowerCase():d,e===c)return!0;return!1},_getParamsObject:function(a){for(var c,d,e=this._router.shouldTypecast,f=this._router.patternLexer.getParamValues(a,this._matchRegexp,e),g={},i=f.length;i--;)d=f[i],this._paramsIds&&(c=this._paramsIds[i],0===c.indexOf("?")&&d&&(g[c+"_"]=d,d=j(d,e),f[i]=d),n&&""===d&&-1!==b(this._optionalParamsIds,c)&&(d=void 0,f[i]=d),g[c]=d),g[i]=d;return g.request_=e?h(a):a,g.vals_=f,g},_getParamsArray:function(a){var b,c=this.rules?this.rules.normalize_:null;return c=c||this._router.normalizeFn,b=c&&g(c)?c(a,this._getParamsObject(a)):this._getParamsObject(a).vals_},interpolate:function(a){var b=this._router.patternLexer.interpolate(this._pattern,a);if(!this._validateParams(b))throw new Error("Generated string doesn't validate against `Route.rules`.");return b},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.empty(),this.switched.empty(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},k.prototype.patternLexer=function(){function a(){var a,b;for(a in n)n.hasOwnProperty(a)&&(b=n[a],b.id="__CR_"+a+"__",b.save="save"in b?b.save.replace("{{id}}",b.id):b.id,b.rRestore=new RegExp(b.id,"g"))}function b(a,b){var c,d=[];for(a.lastIndex=0;c=a.exec(b);)d.push(c[1]);return d}function c(a){return b(m,a)}function d(a){return b(n.OP.rgx,a)}function e(a,b){return a=a||"",a&&(r===o?a=a.replace(k,""):r===q&&(a=a.replace(l,"")),a=f(a,"rgx","save"),a=a.replace(j,"\\$&"),a=f(a,"rRestore","res"),r===o&&(a="\\/?"+a)),r!==p&&(a+="\\/?"),new RegExp("^"+a+"$",b?"i":"")}function f(a,b,c){var d,e;for(e in n)n.hasOwnProperty(e)&&(d=n[e],a=a.replace(d[b],d[c]));return a}function g(a,b,c){var d=b.exec(a);return d&&(d.shift(),c&&(d=i(d))),d}function h(a,b){if("string"!=typeof a)throw new Error("Route pattern should be a string.");var c=function(a,c){var d;if(c="?"===c.substr(0,1)?c.substr(1):c,null!=b[c]){if("object"==typeof b[c]){var e=[];for(var f in b[c])e.push(encodeURI(f+"="+b[c][f]));d="?"+e.join("&")}else d=String(b[c]);if(-1===a.indexOf("*")&&-1!==d.indexOf("/"))throw new Error('Invalid value "'+d+'" for segment "'+a+'".')}else{if(-1!==a.indexOf("{"))throw new Error("The segment "+a+" is required.");d=""}return d};return n.OS.trail||(n.OS.trail=new RegExp("(?:"+n.OS.id+")+$")),a.replace(n.OS.rgx,n.OS.save).replace(m,c).replace(n.OS.trail,"").replace(n.OS.rRestore,"/")}var j=/[\\.+*?\^$\[\](){}\/'#]/g,k=/^\/|\/$/g,l=/\/$/g,m=/(?:\{|:)([^}:]+)(?:\}|:)/g,n={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},o=1,p=2,q=3,r=o;return a(),{strict:function(){r=p},loose:function(){r=o},legacy:function(){r=q},getParamIds:c,getOptionalParamsIds:d,getParamValues:g,compilePattern:e,interpolate:h}}(),window.crossroads=m,m};window.crossroads=b(window.jQuery);var c;!function(a){var b=a.Errors,c=function(){function a(){}return a.isType=function(a,b){for(var c in a.prototype)if(void 0===b[c])return!1;return!0},a.isDeferred=function(a){return null==a?!1:null!=a.pipe&&null!=a.always&&null!=a.done?!0:!1},a.format=function(a,b,c,d,e,f,g,h,i,j,k){for(var l=[b,c,d,e,f,g,h,i,j,k],m=0;m<l.length&&null!=l[m];m++)a=a.replace(new RegExp("\\{"+m+"\\}","g"),function(){return l[m]});return a},a.fileName=function(a,c){if(!a)throw b.argumentNull("url");c=c||!0,a=a.replace("http://","/");var d=a.replace(/^.*[\\\/]/,"");if(c===!0){var e=d.split(".");d=e[0]}return d},a.log=function(a,b){if(void 0===b&&(b=[]),window.console){if(null==b)return void console.log(a);var c=this.format.apply(this,arguments);console.log(c)}},a}();a.Utility=c}(c||(c={}));var c;!function(a){var b=a,c=(a.Utility,a.Errors),d=10,e=function(){function e(d){if(this.pageCreating=b.Callbacks(),this.pageCreated=b.Callbacks(),this.page_stack=[],this._routes=new a.RouteCollection,this._runned=!1,this.controllerFactory=new a.ControllerFactory,this.viewFactory=new a.ViewFactory,null==d)throw c.argumentNull("container");if(!d.container)throw new Error("The config has not a container property.");if(!$.isFunction(d.container)&&!d.container.tagName)throw new Error("Parameter container is not a function or html element.");d.openSwipe=d.openSwipe||function(b){return a.SwipeDirection.None},d.closeSwipe=d.closeSwipe||function(b){return a.SwipeDirection.None},d.scrollType=d.scrollType||function(b){return a.ScrollType.Document},this.config=d}return e.prototype.on_pageCreating=function(b){return a.fireCallback(this.pageCreating,[this,b])},e.prototype.on_pageCreated=function(b){return a.fireCallback(this.pageCreated,[this,b])},e.prototype.routes=function(){return this._routes},e.prototype.controller=function(b){if("object"!=typeof b)throw a.Errors.paramTypeError("routeData","object");if(!b)throw a.Errors.argumentNull("routeData");return this.controllerFactory.getController(b)},e.prototype.currentPage=function(){return this.page_stack.length>0?this.page_stack[this.page_stack.length-1]:null},e.prototype.previousPage=function(){return this.page_stack.length>1?this.page_stack[this.page_stack.length-2]:null},e.prototype.action=function(b){if("object"!=typeof b)throw a.Errors.paramTypeError("routeData","object");if(!b)throw a.Errors.argumentNull("routeData");var d=b.controller;if(!d)throw c.argumentNull("name");if("string"!=typeof d)throw c.routeDataRequireController();var e=b.action;if(!e)throw c.argumentNull("name");if("string"!=typeof e)throw c.routeDataRequireAction();var f=this.controller(b);return f.getAction(e)},e.prototype.hashchange=function(){if(1==window.location.skip)return void(window.location.skip=!1);var b=window.location.hash;if(!b)return void a.Utility.log("The url is not contains hash.");var c="";if(null!=this.previousPage()&&(c=this.previousPage().routeData.url()),c.toLowerCase()==b.substr(1).toLowerCase())this.closeCurrentPage();else{var d=window.location.arguments||{};window.location.arguments=null,this.showPage(b.substr(1),d)}},e.prototype.run=function(){if(!this._runned){$.proxy(this.hashchange,this)(),$(window).bind("hashchange",$.proxy(this.hashchange,this)),this._runned=!0}},e.prototype.getCachePage=function(a){for(var b=this.page_stack.length-1;b>=0;b--)if(this.page_stack[b].name==a)return this.page_stack[b];return null},e.prototype.showPage=function(a,b){if(b=b||{},!a)throw c.argumentNull("url");var e=this.routes().getRouteData(a);if(null==e)throw c.noneRouteMatched(a);var f;if($.isFunction(this.config.container)){if(f=this.config.container(e.values()),null==f)throw new Error("The result of continer function cannt be null")}else f=this.config.container;var g=document.createElement("div");f.appendChild(g);var h=this.createPage(a,g,this.currentPage());if(this.page_stack.push(h),console.log("page_stack lenght:"+this.page_stack.length),this.page_stack.length>d){var i=this.page_stack.shift();i.close({})}var j=this.config.openSwipe(e);return $.extend(b,e.values()),h.open(b,j),h},e.prototype.createPageNode=function(){var a=document.createElement("div");return a},e.prototype.closeCurrentPage=function(){var a=this.currentPage(),b=this.previousPage();if(null!=a){var c=this.config.closeSwipe(a.routeData);a.close({},c),null!=b&&b.show(),this.page_stack.pop(),console.log("page_stack lenght:"+this.page_stack.length)}},e.prototype.createPage=function(a,d,e){if(!a)throw c.argumentNull("url");if(!d)throw c.argumentNull("element");var f=this.routes().getRouteData(a);if(null==f)throw c.noneRouteMatched(a);var g=(f.values().controller,f.values().action,this.controller(f)),h=this.viewFactory.getView(f),i=g.getAction(f),j=new b.ControllerContext(g,h,f);this.on_pageCreating(j);var k=this.config.scrollType(f),l=new b.Page(d,k,e);return l.routeData=f,l.viewDeferred=h,l.actionDeferred=i,this.on_pageCreated(l),l},e.prototype.redirect=function(a,b){return void 0===b&&(b={}),window.location.skip=!0,window.location.hash=a,this.showPage(a,b)},e.prototype.back=function(a){return void 0===a&&(a=void 0),0==window.history.length?$.Deferred().reject():(window.history.back(),$.Deferred().resolve())},e}();a.Application=e}(c||(c={}));var c;!function(a){function b(a,b){var c="http://".toLowerCase();if(a.substr(0,c.length).toLowerCase()==c){var e=document.createElement("a");e.setAttribute("href",a),a=decodeURI(e.pathname);var f=d.addRoute(a);return c+e.host+f.interpolate(b)}var f=d.addRoute(a);return f.interpolate(b)}var c=a.Errors,d=window.crossroads,e=function(){function d(b){this._actions={},this._name=b,this._actions={},this.actionCreated=a.Callbacks()}return d.prototype.name=function(){return this._name},d.prototype.getAction=function(b){var c=b.values().controller;if(!c)throw a.Errors.routeDataRequireController();if(this._name!=c)throw new Error("Not same a controller.");var d=b.values().action;if(!d)throw a.Errors.routeDataRequireAction();return this._actions[d]||(this._actions[d]=this._createAction(b)),this._actions[d]},d.prototype._createAction=function(d){var e=d.values().action;if(!e)throw c.routeDataRequireAction();var g=this,h=b(d.actionPath(),d.values()),i=$.Deferred();return requirejs([h],$.proxy(function(b){b||i.reject();var c=b.func||b;if(!$.isFunction(c))throw a.Errors.modelFileExpecteFunction(this.actionName);var d=new f(g,this.actionName,c);g.actionCreated.fire(g,d),this.result.resolve(d)},{actionName:e,result:i}),$.proxy(function(a){this.result.reject(a)},{actionName:e,result:i})),i},d}();a.Controller=e;var f=function(){function b(b,c,d){if(!b)throw a.Errors.argumentNull("controller");if(!c)throw a.Errors.argumentNull("name");if(!d)throw a.Errors.argumentNull("handle");if(!$.isFunction(d))throw a.Errors.paramTypeError("handle","Function");this._name=c,this._handle=d}return b.prototype.name=function(){return this._name},b.prototype.execute=function(b){if(!b)throw c.argumentNull("page");var d=this._handle.apply({},[b]);return a.Utility.isDeferred(d)?d:$.Deferred().resolve()},b}();a.Action=f}(c||(c={}));var c;!function(a){var b=function(){function a(a,b,c){this._routeData=c,this._controller=a,this._view=b,this._routeData=c}return a.prototype.controller=function(){return this._controller},a.prototype.view=function(){return this._view},a.prototype.routeData=function(){return this._routeData},a}();a.ControllerContext=b}(c||(c={}));var c;!function(a){var b=a.Errors,c=function(){function c(){this._controllers={},this._controllers={}}return c.prototype.controllers=function(){return this._controllers},c.prototype.createController=function(b){return new a.Controller(b)},c.prototype.actionLocationFormater=function(){return this._actionLocationFormater},c.prototype.getController=function(a){if(!a.values().controller)throw b.routeDataRequireController();return this._controllers[a.values().controller]||(this._controllers[a.values().controller]=this.createController(a.values().controller)),this._controllers[a.values().controller]},c}();a.ControllerFactory=c}(c||(c={}));var c;!function(a){var b=a.Utility,c=function(){function a(){}return a.argumentNull=function(a){var c=b.format('The argument "{0}" cannt be null.',a);return new Error(c)},a.modelFileExpecteFunction=function(a){var c=b.format('The eval result of script file "{0}" is expected a function.',a);return new Error(c)},a.paramTypeError=function(a,c){var d=b.format('The param "{0}" is expected "{1}" type.',a,c);return new Error(d)},a.viewNodeNotExists=function(a){var c=b.format('The view node "{0}" is not exists.',a);return new Error(c)},a.pathPairRequireView=function(a){var c=b.format('The view value is required for path pair, but the item with index "{0}" is miss it.',a);return new Error(c)},a.notImplemented=function(a){var c=b.format('The method "{0}" is not implemented.',a);return new Error(c)},a.routeExists=function(a){var c=b.format('Route named "{0}" is exists.',a);return new Error(c)},a.routeResultRequireController=function(a){var c=b.format('The parse result of route "{0}" does not contains controler.',a);return new Error(c)},a.routeResultRequireAction=function(a){var c=b.format('The parse result of route "{0}" does not contains action.',a);return new Error(c)},a.ambiguityRouteMatched=function(a,c,d){var e=b.format("Ambiguity route matched, {0} is match in {1} and {2}.",a,c,d);return new Error(e)},a.noneRouteMatched=function(a){var c=b.format('None route matched with url "{0}".',a),d=new Error(c);return d},a.emptyStack=function(){return new Error("The stack is empty.")},a.canntParseUrl=function(a){var c=b.format('Can not parse the url "{0}" to route data.',a);return new Error(c)},a.routeDataRequireController=function(){var a='The route data does not contains a "controller" file.';return new Error(a)},a.routeDataRequireAction=function(){var a='The route data does not contains a "action" file.';return new Error(a)},a.parameterRequireField=function(a,c){var d=b.format("Parameter {1} does not contains field {0}.",a,c);return new Error(d)},a.viewCanntNull=function(){var a="The view or viewDeferred of the page cannt null.";return new Error(a)},a}();a.Errors=c}(c||(c={}));var c;!function(a){function b(a){var b=f[a]={};return jQuery.each(a.match(e)||[],function(a,c){b[c]=!0}),b}function c(c){void 0===c&&(c=null),c="string"==typeof c?f[c]||b(c):jQuery.extend({},c);var d,e,g,h,i,j,k=[],l=!c.once&&[],m=function(a){for(d=c.memory&&a,e=!0,j=h||0,h=0,i=k.length,g=!0;k&&i>j;j++){var b=k[j].apply(a[0],a[1]);if(null!=b&&a[0].results.push(b),b===!1&&c.stopOnFalse){d=!1;break}}g=!1,k&&(l?l.length&&m(l.shift()):d?k=[]:n.disable())},n={results:[],add:function(){if(k){var a=k.length;!function b(a){jQuery.each(a,function(a,d){var e=jQuery.type(d);"function"===e?c.unique&&n.has(d)||k.push(d):d&&d.length&&"string"!==e&&b(d)})}(arguments),g?i=k.length:d&&(h=a,m(d))}return this},remove:function(){return k&&jQuery.each(arguments,function(a,b){for(var c;(c=jQuery.inArray(b,k,c))>-1;)k.splice(c,1),g&&(i>=c&&i--,j>=c&&j--)}),this},has:function(a){return a?jQuery.inArray(a,k)>-1:!(!k||!k.length)},empty:function(){return k=[],i=0,this},disable:function(){return k=l=d=void 0,this},disabled:function(){return!k},lock:function(){return l=void 0,d||n.disable(),this},locked:function(){return!l},fireWith:function(a,b){return a.results=[],!k||e&&!l||(b=b||[],b=[a,b.slice?b.slice():b],g?l.push(b):m(b)),a.results},fire:function(){return n.fireWith(this,arguments)},fired:function(){return!!e},count:function(){return k.length}};return new a.Callback(n)}function d(b,c){for(var d=b.fire.apply(b,c),e=[],f=0;f<d.length;f++)a.Utility.isDeferred(d[f])&&e.push(d[f]);return 0==e.length?$.Deferred().resolve():$.when.apply($,e)}var e=/\S+/g,f={},g=function(){function a(a){this.source=a}return a.prototype.add=function(a){this.source.add(a)},a.prototype.remove=function(a){this.source.remove(a)},a.prototype.has=function(a){return this.source.has(a)},a.prototype.fireWith=function(a,b){return this.source.fireWith(a,b)},a.prototype.fire=function(a,b,c,d){return this.source.fire(a,b,c)},a}();a.Callback=g,a.Callbacks=c,a.fireCallback=d;var h=window.crossroads;$.extend(h,{_create:h.create,create:function(){var b=this._create();return b.getRouteData=function(b,c){if(b=b||"",c=c||[],this.ignoreState||b!==this._prevMatchedRequest&&b!==this._prevBypassedRequest){var d=this._getMatchedRoutes(b),e=d.length;if(0==e)return null;if(e>1)throw a.Errors.ambiguityRouteMatched(b,"route1","route2");return d[0]}},b}})}(c||(c={}));var c;!function(a){function b(b,c,d){return void 0===d&&(d={}),a.fireCallback(b,[c,d])}var c=a,d=(a.Utility,a.Errors),e="page-node",f="page-header",h="page-body",i="page-footer",k="page-loading",m="page-content",n='<i class="icon-spinner icon-spin"></i><span style="padding-left:10px;">数据正在加载中...</span>';!function(a){a[a.open=0]="open",a[a.scroll=1]="scroll",a[a.pullDown=2]="pullDown",a[a.pullUp=3]="pullUp",a[a.custom=4]="custom"}(a.PageLoadType||(a.PageLoadType={}));var o,p=a.PageLoadType;!function(a){a[a.swipeLeft=0]="swipeLeft",a[a.swipeRight=1]="swipeRight",a[a.none=2]="none"}(o||(o={}));var q;!function(a){a[a.header=1]="header",a[a.body=2]="body",a[a.loading=4]="loading",a[a.footer=8]="footer"}(q||(q={}));var r;!function(a){a[a.open=0]="open",a[a.closed=1]="closed"}(r||(r={})),function(a){a[a.None=0]="None",a[a.Left=1]="Left",a[a.Right=2]="Right",a[a.Up=3]="Up",a[a.Donw=4]="Donw"}(a.SwipeDirection||(a.SwipeDirection={}));var s=a.SwipeDirection;!function(a){a[a.IScroll=0]="IScroll",a[a.Div=1]="Div",a[a.Document=2]="Document"}(a.ScrollType||(a.ScrollType={}));var t=a.ScrollType,u=function(){function a(a){a.className=e,this.container=a,this.header=document.createElement("div"),this.header.className=f,a.appendChild(this.header),this.body=document.createElement("div"),this.body.className=h,a.appendChild(this.body),this.content=document.createElement("div"),this.content.className=m,$(this.content).hide(),this.body.appendChild(this.content),this.loading=document.createElement("div"),this.loading.className=k,this.loading.innerHTML='<div class="spin"><i class="icon-spinner icon-spin"></i><div>',this.body.appendChild(this.loading),this.footer=document.createElement("div"),this.footer.className=i,a.appendChild(this.footer)}return a}(),v=function(){function e(a,b,f){var h=this;if(this._loadViewModelResult=null,this._openResult=null,this._hideResult=null,this._showTime=e.animationTime,this._hideTime=e.animationTime,this._enableScrollLoad=!1,this.is_closed=!1,this.preLoad=c.Callbacks(),this.load=c.Callbacks(),this.closing=c.Callbacks(),this.closed=c.Callbacks(),this.scroll=c.Callbacks(),this.showing=c.Callbacks(),this.shown=c.Callbacks(),this.hiding=c.Callbacks(),this.hidden=c.Callbacks(),this.scrollEnd=c.Callbacks(),this.viewChanged=$.Callbacks(),!a)throw d.argumentNull("element");if(null==b)throw d.argumentNull("scrollType");this._prevous=f,this._pageNode=new u(a),b==t.IScroll?($(this.nodes().container).addClass("ios"),this.ios_scroller=new l(this)):b==t.Div?($(this.nodes().container).addClass("div"),new g(this)):b==t.Document&&($(this.nodes().container).addClass("doc"),new j(this)),this.scrollEnd.add(e.page_scrollEnd),f&&f.closing.add(function(){return h.close()})}return Object.defineProperty(e.prototype,"viewDeferred",{get:function(){return this._viewDeferred},set:function(a){this._viewDeferred=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actionDeferred",{get:function(){return this._actionDeferred},set:function(a){this._actionDeferred=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableScrollLoad",{get:function(){return this._enableScrollLoad},set:function(a){this._enableScrollLoad=a,null==this.scrollLoad_loading_bar&&(this.scrollLoad_loading_bar=document.createElement("div"),this.scrollLoad_loading_bar.innerHTML='<div name="scrollLoad_loading" style="padding:10px 0px 10px 0px;"><h5 class="text-center"></h5></div>',this.scrollLoad_loading_bar.style.display="none",$(this.scrollLoad_loading_bar).find("h5").html(n),this.nodes().content.appendChild(this.scrollLoad_loading_bar)),a||null==this.scrollLoad_loading_bar||($(this.scrollLoad_loading_bar).hide(),this.refreshUI())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this.nodes().container.innerHTML},set:function(a){this.nodes().content.innerHTML=a;var b=this.nodes().content.querySelector('[ch-part="header"]');b&&this.nodes().header.appendChild(b),b=this.nodes().content.querySelector('[ch-part="footer"]'),b&&this.nodes().footer.appendChild(b),this.viewChanged.fire()},enumerable:!0,configurable:!0}),e.getPageName=function(a){var b;if(a.pageName()){var c=window.crossroads.addRoute(a.pageName());b=c.interpolate(a.values())}else b=a.values().controller+"."+a.values().action;return b},Object.defineProperty(e.prototype,"routeData",{get:function(){return this._routeData},set:function(a){this._routeData=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name||(this._name=e.getPageName(this.routeData)),this._name},enumerable:!0,configurable:!0}),e.prototype.node=function(){return this._pageNode.container},e.prototype.nodes=function(){return this._pageNode},Object.defineProperty(e.prototype,"parent",{get:function(){return this._prevous},enumerable:!0,configurable:!0}),e.prototype.hide=function(a){$(this.node()).is(":visible")&&(a=a||s.None,this.hidePageNode(a))},e.prototype.show=function(a){$(this.node()).is(":visible")||(a=a||s.None,this.showPageNode(a))},e.prototype.visible=function(){return $(this.node()).is(":visible")},e.prototype.hidePageNode=function(a){var b=this;this.on_hiding({}),window.move||(a=s.None,console.warn("Move is not loaded and swipe is auto disabled."));var c=$.Deferred(),d=$(this.nodes().container).width(),e=$(this.nodes().container).height(),f=function(){$(b.node()).hide(),c.resolve(),b.on_hidden({})};switch(a){case s.None:default:f();break;case s.Up:move(this.nodes().container).y(e).end().y(0-e).duration(this._hideTime).end(f);break;case s.Donw:move(this.nodes().container).y(e).duration(this._hideTime).end(f);break;case s.Right:move(this.node()).x(d).duration(this._hideTime).end(f);break;case s.Left:move(this.node()).x(0-d).duration(this._hideTime).end(f)}return c},e.prototype.showPageNode=function(a){var b=this;window.move||(a=s.None,console.warn("Move is not loaded and swipe is auto disabled.")),this.on_showing({});var c=$.Deferred();this.node().style.display="block";var d=$(this.nodes().container).width(),e=$(this.nodes().container).height(),f=function(){c.resolve()};switch(a){case s.None:default:f();break;case s.Donw:move(this.node()).y(0-e).duration(0).end(f),move(this.node()).y(0).duration(0).end(f);break;case s.Up:move(this.node()).y(e).duration(0).end(),move(this.node()).y(0).duration(this._showTime).end(f);break;case s.Right:move(this.node()).x(0-d).duration(0).end(),move(this.node()).x(0).duration(this._showTime).end(f);break;case s.Left:move(this.node()).x(d).duration(0).end(),move(this.node()).x(0).duration(this._showTime).end(f)}return c.done(function(){null!=b._prevous&&b._prevous.hide(),b.on_shown({})}),c},e.prototype.on_load=function(a){var c=this,d=b(this.load,this,a);return a.loadType==p.open&&d.done(function(){$(c.nodes().loading).hide(),$(c.nodes().content).show()}),d.done(function(){window.setTimeout(function(){return c.refreshUI()},100)}),d},e.prototype.on_closed=function(a){return b(this.closed,this,a)},e.prototype.on_scroll=function(a){return b(this.scroll,this,a)},e.prototype.on_showing=function(a){return b(this.showing,this,a)},e.prototype.on_shown=function(a){return b(this.shown,this,a)},e.prototype.on_hiding=function(a){return b(this.hiding,this,a)},e.prototype.on_hidden=function(a){return b(this.hidden,this,a)},e.prototype.on_scrollEnd=function(a){return b(this.scrollEnd,this,a)},e.prototype.open=function(b,c){var d=this;if(this._openResult)return this._openResult;if(c=c||s.None,this.showPageNode(c),b=$.extend(b||{},{loadType:a.PageLoadType.open}),null==this.viewDeferred&&null==this.view)throw a.Errors.viewCanntNull();this.actionDeferred&&this.actionDeferred.done(function(c){c.execute(d),d.viewDeferred&&d.viewDeferred.done(function(a){return d.view=a});var e=b;e.loadType=a.PageLoadType.open,d.on_load(e)})},e.prototype.close=function(a,b){var c=this;this.is_closed||(this.hidePageNode(b).done(function(){$(c.node()).remove()}),a=a||{},this.on_closed(a),this.is_closed=!0)},e.page_scrollEnd=function(a,b){var c=b.scrollTop,d=b.scrollHeight,e=b.clientHeight,f=e/3;if(!(d-f>e+c)&&a.enableScrollLoad){null!=a.scrollLoad_loading_bar&&"none"==a.scrollLoad_loading_bar.style.display&&(a.scrollLoad_loading_bar.style.display="block",a.refreshUI());var g=$.extend(a.routeData.values(),{loadType:p.scroll});a.on_load(g)}},e.prototype.refreshUI=function(){this.ios_scroller&&this.ios_scroller.refresh()},e.animationTime=300,e}();a.Page=v}(c||(c={}));var c;!function(a){var b=function(){function a(a,b,c){this._name=a,this._pattern=b,this._defaults=c}return a.prototype.name=function(){return this._name},a.prototype.defaults=function(){return this._defaults},a.prototype.url=function(){return this._pattern},a}();a.Route=b}(c||(c={}));var c;!function(a){var b=a.Errors,c=function(){function c(){this._init()}return c.prototype._init=function(){var a=window.crossroads;this._source=a.create(),this._source.ignoreCase=!0,this._source.normalizeFn=a.NORM_AS_OBJECT,this._priority=0},c.prototype.count=function(){return this._source.getNumRoutes()},c.prototype.mapRoute=function(c){c=c||{};var d=c.name,e=c.url,f=c.defaults,g=c.rules||{};if(!d)throw b.argumentNull("name");if(!e)throw b.argumentNull("url");this._priority=this._priority+1;var h=new a.Route(d,e,f);h.viewPath=c.viewPath,h.actionPath=c.actionPath;var i=this._source.addRoute(e,function(a){},this._priority);if(i.rules=g,i.newRoute=h,null==this._defaultRoute){if(this._defaultRoute=h,null==this._defaultRoute.viewPath)throw new Error("default route require view path.");if(null==this._defaultRoute.actionPath)throw new Error("default route require action path.")}return h.viewPath=h.viewPath||this._defaultRoute.viewPath,h.actionPath=h.actionPath||this._defaultRoute.actionPath,h},c.prototype.getRouteData=function(c){var d=this._source.getRouteData(c);if(null==d)throw b.canntParseUrl(c);for(var e={},f=d.route._paramsIds||[],g=0;g<f.length;g++){var h=f[g];e[h]=d.params[0][h]}var i=new a.RouteData(c);return i.values(e),i.actionPath(d.route.newRoute.actionPath),i.viewPath(d.route.newRoute.viewPath),i},c.defaultRouteName="default",c}();a.RouteCollection=c}(c||(c={}));var c;!function(a){var b=function(){function a(a){this._url=a}return a.prototype.values=function(a){return void 0===a&&(a=void 0),void 0!==a&&(this._values=a),this._values},a.prototype.viewPath=function(a){return void 0===a&&(a=void 0),void 0!==a&&(this._viewPath=a),this._viewPath},a.prototype.actionPath=function(a){return void 0===a&&(a=void 0),void 0!==a&&(this._actionPath=a),this._actionPath},a.prototype.pageName=function(a){return void 0===a&&(a=void 0),void 0!==a&&(this._pageName=a),this._pageName},a.prototype.url=function(){return this._url},a}();a.RouteData=b}(c||(c={}));var d,e,f=function(){function a(){}return a}(),g=function(){function a(a){var b,c,d=new f,e=300,g=function(a){null==c&&(c=0,c=window.setInterval(function(){return b==d.scrollTop?(window.clearInterval(c),c=null,b=null,void a.on_scrollEnd(d)):void(b=d.scrollTop)},e))},h=a.nodes().body;h.onscroll=function(){var b={scrollTop:h.scrollTop,scrollHeight:h.scrollHeight,clientHeight:h.clientHeight};a.on_scroll(b),d.clientHeight=b.clientHeight,d.scrollHeight=b.scrollHeight,d.scrollTop=b.scrollTop,g(a)}}return a}(),h=new f,i=300,j=function(){function b(b){$(document).scroll(function(c){if(b.visible()){var d={scrollTop:$(document).scrollTop(),scrollHeight:document.body.scrollHeight,clientHeight:$(window).height()};h.clientHeight=d.clientHeight,h.scrollHeight=d.scrollHeight,h.scrollTop=d.scrollTop,$(b.node()).data(b.name+"_scroll_top",d.scrollTop),a(b)}}),b.shown.add(function(a){var c=$(b.node()).data(b.name+"_scroll_top");null!=c&&$(document).scrollTop(new Number(c).valueOf())})}return b}(),k=this,l=function(){function a(a){var b={tap:!0,useTransition:!1,HWCompositing:!1,preventDefault:!0,probeType:1},c=this.iscroller=a.iscroller=new IScroll(a.nodes().body,b);c.on("scrollEnd",function(){var b=this,c={scrollTop:0-b.y,scrollHeight:b.scrollerHeight,clientHeight:b.wrapperHeight};console.log("directionY:"+b.directionY),console.log("startY:"+b.startY),console.log("scroller.y:"+b.y),a.on_scrollEnd(c)}),
c.on("scroll",function(){var b=this,c={scrollTop:0-b.y,scrollHeight:b.scrollerHeight,clientHeight:b.wrapperHeight};console.log("directionY:"+b.directionY),console.log("startY:"+b.startY),console.log("scroller.y:"+b.y),a.on_scroll(c)}),function(b,c){$(c).on("tap",function(b){if(0!=a.iscroller.enabled)for(var c=4,d=1,e=b.target;null!=e;){if("A"==e.tagName)return window.open($(e).attr("href"),"_self");if(e=e.parentNode,d+=1,d>c)return}})}(c,a.nodes().body),a.closed.add(function(){return c.destroy()}),$(window).on("resize",function(){window.setTimeout(function(){return c.refresh()},500)})}return a.prototype.refresh=function(){this.iscroller.refresh()},a}();c.scroll=function(a,b){$(a.nodes().body).addClass("wrapper"),$(a.nodes().content).addClass("scroller");a._wrapperNode=a.nodes().body;a._scrollerNode=a.nodes().content,$.extend(a,{scrollEnd:c.Callbacks(),on_scrollEnd:function(a){return c.fireCallback(this.scrollEnd,[this,a])},scrollTop:$.proxy(function(b){if(void 0===b)return 0-a.iscroller.y+"px";"string"==typeof b&&(b=new Number(b.substr(0,b.length-2)).valueOf());var c=k.iscroller;c&&c.scrollTo(0,b)},a)})};var c;!function(a){var b=a.Errors,c=function(){function a(){}return a.isType=function(a,b){for(var c in a.prototype)if(void 0===b[c])return!1;return!0},a.isDeferred=function(a){return null==a?!1:null!=a.pipe&&null!=a.always&&null!=a.done?!0:!1},a.format=function(a,b,c,d,e,f,g,h,i,j,k){for(var l=[b,c,d,e,f,g,h,i,j,k],m=0;m<l.length&&null!=l[m];m++)a=a.replace(new RegExp("\\{"+m+"\\}","g"),function(){return l[m]});return a},a.fileName=function(a,c){if(!a)throw b.argumentNull("url");c=c||!0,a=a.replace("http://","/");var d=a.replace(/^.*[\\\/]/,"");if(c===!0){var e=d.split(".");d=e[0]}return d},a.log=function(a,b){if(void 0===b&&(b=[]),window.console){if(null==b)return void console.log(a);var c=this.format.apply(this,arguments);console.log(c)}},a}();a.Utility=c}(c||(c={}));var c;return function(a){function b(a,b){var c="http://".toLowerCase();if(a.substr(0,c.length).toLowerCase()==c){var e=document.createElement("a");e.setAttribute("href",a),a=decodeURI(e.pathname);var f=d.addRoute(a);return c+e.host+f.interpolate(b)}var f=d.addRoute(a);return f.interpolate(b)}var c=a.Errors,d=window.crossroads,e=function(){function a(){this._views=[]}return a.prototype.getView=function(a){if(!a.values().controller)throw c.routeDataRequireController();if(!a.values().action)throw c.routeDataRequireAction();var d=b(a.viewPath(),a.values()),e=a.values().controller+"_"+a.values().action;if(!this._views[e]){this._views[e]=$.Deferred();var f="http://";d.substr(0,f.length).toLowerCase()==f?$.ajax({url:d}).done($.proxy(function(a){null!=a?this.deferred.resolve(a):this.deferred.reject()},{deferred:this._views[e]})).fail($.proxy(function(a){this.deferred.reject(a)},{deferred:this._views[e]})):requirejs(["text!"+d],$.proxy(function(a){null!=a?this.deferred.resolve(a):this.deferred.reject()},{deferred:this._views[e]}),$.proxy(function(a){this.deferred.reject(a)},{deferred:this._views[e]}))}return this._views[e]},a}();a.ViewFactory=e}(c||(c={})),window.chitu=c,c});