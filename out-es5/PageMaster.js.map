{"version":3,"sources":["../out/PageMaster.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","define","require","exports","maishu_chitu_service_1","Page_1","Application_1","Errors_1","Object","defineProperty","PageMaster","containers","parser","pageCreated","Callbacks","pageShowing","pageShown","pageType","Page","pageDisplayType","PageDisplayerImplement","cachePages","page_stack","Array","nodes","MAX_PAGE_COUNT","pageTagName","pagePlaceholder","defaultPagePlaceholder","error","_defaultPageNodeParser","defaultPageNodeParser","Errors","argumentNull","actions","sender","page","message","pages","filter","o","name","forEach","p","messageReceived","fire","url","loadjs","actionExports","exportsCanntNull","_action","default","canntFindAction","isClass","action","path","reslove","requirejs","err","containerName","pageUrl","key","values","cachePageKey","cachePage","r","parseUrl","data","assign","isNew","createPage","on_pageCreated","element","createPageElement","pageName","displayer","container","containerIsNotExists","console","assert","app","showing","style","removeProperty","display","shown","add","closed","remove","placeholder","querySelector","document","createElement","appendChild","args","forceRender","funs","arg","createPageUrl","currentPage","Application","DefaultContainerName","getPage","findPageAction","actionCanntNull","show","pushPage","push","length","shift","close","routeData","node","findPageNode","pageNodeNotExists","parse","passData","pop","split","join","createDefaultAction","toString","Function","prototype","fnBody","fn","call","replace","test"],"mappings":"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","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\ndefine([\"require\", \"exports\", \"maishu-chitu-service\", \"./Page\", \"./Application\", \"./Errors\"], function (require, exports, maishu_chitu_service_1, Page_1, Application_1, Errors_1) {\r\n    \"use strict\";\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    class PageMaster {\r\n        constructor(containers, parser) {\r\n            this.pageCreated = maishu_chitu_service_1.Callbacks();\r\n            this.pageShowing = maishu_chitu_service_1.Callbacks();\r\n            this.pageShown = maishu_chitu_service_1.Callbacks();\r\n            this.pageType = Page_1.Page;\r\n            this.pageDisplayType = Page_1.PageDisplayerImplement;\r\n            this.cachePages = {};\r\n            this.page_stack = new Array();\r\n            this.nodes = {};\r\n            this.MAX_PAGE_COUNT = 100;\r\n            this.pageTagName = \"div\";\r\n            this.pagePlaceholder = PageMaster.defaultPagePlaceholder;\r\n            this.error = maishu_chitu_service_1.Callbacks();\r\n            this._defaultPageNodeParser = null;\r\n            this.parser = parser || this.defaultPageNodeParser;\r\n            if (!containers)\r\n                throw Errors_1.Errors.argumentNull(\"containers\");\r\n            this.parser.actions = this.parser.actions || {};\r\n            this.containers = containers;\r\n        }\r\n        sendMessage(sender, page, message) {\r\n            let pages;\r\n            if (typeof page == \"string\")\r\n                pages = this.page_stack.filter(o => o.name == page);\r\n            else\r\n                pages = this.page_stack.filter(o => o instanceof page);\r\n            pages.forEach(p => {\r\n                p.messageReceived.fire(sender, message);\r\n            });\r\n        }\r\n        get defaultPageNodeParser() {\r\n            if (this._defaultPageNodeParser == null) {\r\n                let nodes = {};\r\n                this._defaultPageNodeParser = {\r\n                    actions: {},\r\n                    parse: (pageName) => {\r\n                        let node = nodes[pageName];\r\n                        if (node == null) {\r\n                            let path = `modules_${pageName}`.split('_').join('/');\r\n                            node = { action: this.createDefaultAction(path, this.loadjs), name: pageName };\r\n                            nodes[pageName] = node;\r\n                        }\r\n                        return node;\r\n                    }\r\n                };\r\n            }\r\n            return this._defaultPageNodeParser;\r\n        }\r\n        createDefaultAction(url, loadjs) {\r\n            return (page) => __awaiter(this, void 0, void 0, function* () {\r\n                let actionExports = yield loadjs(url);\r\n                if (!actionExports)\r\n                    throw Errors_1.Errors.exportsCanntNull(url);\r\n                let _action = actionExports.default;\r\n                if (_action == null) {\r\n                    throw Errors_1.Errors.canntFindAction(page.name);\r\n                }\r\n                let result;\r\n                if (PageMaster.isClass(_action)) {\r\n                    let action = _action;\r\n                    result = new action(page, this);\r\n                }\r\n                else {\r\n                    let action = _action;\r\n                    result = action(page, this);\r\n                }\r\n                return result;\r\n            });\r\n        }\r\n        loadjs(path) {\r\n            return new Promise((reslove, reject) => {\r\n                requirejs([path], function (result) {\r\n                    reslove(result);\r\n                }, function (err) {\r\n                    reject(err);\r\n                });\r\n            });\r\n        }\r\n        on_pageCreated(page) {\r\n            return this.pageCreated.fire(this, page);\r\n        }\r\n        get currentPage() {\r\n            if (this.page_stack.length > 0)\r\n                return this.page_stack[this.page_stack.length - 1];\r\n            return null;\r\n        }\r\n        cachePageKey(containerName, pageUrl) {\r\n            let key = `${containerName}_${pageUrl}`;\r\n            return key;\r\n        }\r\n        getPage(pageUrl, containerName, values) {\r\n            if (!pageUrl)\r\n                throw Errors_1.Errors.argumentNull('pageUrl');\r\n            let key = this.cachePageKey(containerName, pageUrl);\r\n            values = values || {};\r\n            let cachePage = this.cachePages[key];\r\n            if (cachePage != null) {\r\n                let r = Application_1.parseUrl(pageUrl);\r\n                cachePage.data = Object.assign(values || {}, r.values);\r\n                return { page: cachePage, isNew: false };\r\n            }\r\n            let page = this.createPage(pageUrl, containerName, values);\r\n            this.cachePages[key] = page;\r\n            this.on_pageCreated(page);\r\n            return { page, isNew: true };\r\n        }\r\n        createPage(pageUrl, containerName, values) {\r\n            if (!pageUrl)\r\n                throw Errors_1.Errors.argumentNull('pageUrl');\r\n            if (!containerName)\r\n                throw Errors_1.Errors.argumentNull('containerName');\r\n            values = values || {};\r\n            let r = Application_1.parseUrl(pageUrl);\r\n            let element = this.createPageElement(r.pageName, containerName);\r\n            let displayer = new this.pageDisplayType(this);\r\n            let container = this.containers[containerName];\r\n            if (!container)\r\n                throw Errors_1.Errors.containerIsNotExists(containerName);\r\n            console.assert(this.pageType != null);\r\n            let page = new this.pageType({\r\n                app: this,\r\n                url: pageUrl,\r\n                data: values,\r\n                displayer,\r\n                element,\r\n                container: { name: containerName, element: container },\r\n            });\r\n            let showing = (sender) => {\r\n                for (let key in this.containers) {\r\n                    if (key == sender.container.name) {\r\n                        sender.container.element.style.removeProperty('display');\r\n                    }\r\n                    else {\r\n                        this.containers[key].style.display = 'none';\r\n                    }\r\n                }\r\n                this.pageShowing.fire(this, sender);\r\n            };\r\n            let shown = (sender) => {\r\n                this.pageShown.fire(this, sender);\r\n            };\r\n            page.showing.add(showing);\r\n            page.shown.add(shown);\r\n            page.closed.add(() => {\r\n                page.showing.remove(showing);\r\n                page.shown.remove(shown);\r\n                let key = this.cachePageKey(page.container.name, page.url);\r\n                delete this.cachePages[key];\r\n                this.page_stack = this.page_stack.filter(o => o != page);\r\n            });\r\n            return page;\r\n        }\r\n        createPageElement(pageName, containerName) {\r\n            if (!containerName)\r\n                throw Errors_1.Errors.argumentNull('containerName');\r\n            let container = this.containers[containerName];\r\n            if (!container)\r\n                throw Errors_1.Errors.containerIsNotExists(containerName);\r\n            let placeholder = container.querySelector(`.${this.pagePlaceholder}`);\r\n            if (placeholder == null)\r\n                placeholder = container;\r\n            let element = document.createElement(this.pageTagName);\r\n            placeholder.appendChild(element);\r\n            return element;\r\n        }\r\n        showPage(pageUrl, args, forceRender) {\r\n            args = args || {};\r\n            forceRender = forceRender == null ? false : true;\r\n            let values = {};\r\n            let funs = {};\r\n            for (let key in args) {\r\n                let arg = args[key];\r\n                if (typeof arg == 'function') {\r\n                    funs[key] = arg;\r\n                }\r\n                else {\r\n                    values[key] = arg;\r\n                }\r\n            }\r\n            let r = Application_1.parseUrl(pageUrl);\r\n            values = Object.assign(values, r.values);\r\n            pageUrl = Application_1.createPageUrl(r.pageName, values);\r\n            if (!pageUrl)\r\n                throw Errors_1.Errors.argumentNull('pageName');\r\n            if (this.currentPage != null && this.currentPage.url == pageUrl)\r\n                return this.currentPage;\r\n            let containerName = values.container || Application_1.Application.DefaultContainerName;\r\n            let { page, isNew } = this.getPage(pageUrl, containerName, args);\r\n            if (isNew || forceRender) {\r\n                let action = this.findPageAction(pageUrl);\r\n                if (action == null)\r\n                    throw Errors_1.Errors.actionCanntNull(pageUrl);\r\n                action(page, this);\r\n            }\r\n            page.show();\r\n            this.pushPage(page);\r\n            console.assert(page == this.currentPage, \"page is not current page\");\r\n            return page;\r\n        }\r\n        reload(page) {\r\n            let action = this.findPageAction(page.url);\r\n            console.assert(action != null);\r\n            action(page, this);\r\n        }\r\n        pushPage(page) {\r\n            this.page_stack.push(page);\r\n            if (this.page_stack.length > this.MAX_PAGE_COUNT) {\r\n                let page = this.page_stack.shift();\r\n                if (page) {\r\n                    page.close();\r\n                }\r\n            }\r\n        }\r\n        findPageAction(pageUrl) {\r\n            let routeData = Application_1.parseUrl(pageUrl);\r\n            let pageName = routeData.pageName;\r\n            let node = this.findPageNode(pageName);\r\n            if (node == null)\r\n                throw Errors_1.Errors.pageNodeNotExists(pageName);\r\n            let action = node.action;\r\n            if (action == null)\r\n                throw Errors_1.Errors.actionCanntNull(pageName);\r\n            return node.action;\r\n        }\r\n        findPageNode(pageName) {\r\n            if (this.nodes[pageName])\r\n                return this.nodes[pageName];\r\n            let node = null;\r\n            let action = this.parser.actions ? this.parser.actions[pageName] : null;\r\n            if (action != null) {\r\n                node = { action, name: pageName };\r\n            }\r\n            if (node == null && this.parser.parse != null) {\r\n                node = this.parser.parse(pageName, this);\r\n                console.assert(node.action != null);\r\n            }\r\n            if (node != null)\r\n                this.nodes[pageName] = node;\r\n            return node;\r\n        }\r\n        closeCurrentPage(passData) {\r\n            var page = this.page_stack.pop();\r\n            if (page == null)\r\n                return;\r\n            page.close();\r\n            if (this.currentPage) {\r\n                if (passData) {\r\n                    console.assert(this.currentPage.data != null);\r\n                    this.currentPage.data = Object.assign(this.currentPage.data, passData);\r\n                }\r\n                this.currentPage.show();\r\n            }\r\n        }\r\n        get pageStack() {\r\n            return this.page_stack;\r\n        }\r\n    }\r\n    PageMaster.defaultPagePlaceholder = \"page-placeholder\";\r\n    PageMaster.isClass = (function () {\r\n        var toString = Function.prototype.toString;\r\n        function fnBody(fn) {\r\n            return toString.call(fn).replace(/^[^{]*{\\s*/, '').replace(/\\s*}[^}]*$/, '');\r\n        }\r\n        function isClass(fn) {\r\n            return (typeof fn === 'function' &&\r\n                (/^class(\\s|\\{\\}$)/.test(toString.call(fn)) ||\r\n                    (/^.*classCallCheck\\(/.test(fnBody(fn)))));\r\n        }\r\n        return isClass;\r\n    })();\r\n    exports.PageMaster = PageMaster;\r\n});\r\n"],"file":"PageMaster.js"}