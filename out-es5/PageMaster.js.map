{"version":3,"sources":["../out/PageMaster.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","define","require","exports","maishu_chitu_service_1","Page_1","Application_1","Errors_1","Object","defineProperty","PageMaster","container","parser","pageCreated","Callbacks","pageShowing","pageShown","pageType","Page","pageDisplayType","PageDisplayerImplement","cachePages","page_stack","Array","nodes","MAX_PAGE_COUNT","error","defaultPageNodeParser","Errors","argumentNull","actions","p","parse","pageName","node","path","split","join","action","createDefaultAction","loadjs","name","url","page","actionExports","exportsCanntNull","_action","default","canntFindAction","isClass","reslove","requirejs","err","fire","pageUrl","values","cachePage","data","isNew","createPage","on_pageCreated","element","createPageElement","displayer","console","assert","app","showing","sender","shown","add","closed","remove","document","createElement","tagName","appendChild","args","forceRender","currentPage","getPage","findPageAction","actionCanntNull","show","pushPage","close","filter","o","push","length","shift","closePage","routeData","parseUrl","findSiteMapNode","pageNodeNotExists","passData","pop","assign","toString","Function","prototype","fnBody","fn","call","replace","test"],"mappings":"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","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\ndefine([\"require\", \"exports\", \"maishu-chitu-service\", \"./Page\", \"./Application\", \"./Errors\"], function (require, exports, maishu_chitu_service_1, Page_1, Application_1, Errors_1) {\n    \"use strict\";\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    class PageMaster {\n        constructor(container, parser) {\n            this.pageCreated = maishu_chitu_service_1.Callbacks();\n            this.pageShowing = maishu_chitu_service_1.Callbacks();\n            this.pageShown = maishu_chitu_service_1.Callbacks();\n            this.pageType = Page_1.Page;\n            this.pageDisplayType = Page_1.PageDisplayerImplement;\n            this.cachePages = {};\n            this.page_stack = new Array();\n            this.nodes = {};\n            this.MAX_PAGE_COUNT = 100;\n            this.error = maishu_chitu_service_1.Callbacks();\n            this.parser = parser || this.defaultPageNodeParser();\n            if (!container)\n                throw Errors_1.Errors.argumentNull(\"container\");\n            this.parser.actions = this.parser.actions || {};\n            this.container = container;\n        }\n        defaultPageNodeParser() {\n            let nodes = {};\n            let p = {\n                actions: {},\n                parse: (pageName) => {\n                    let node = nodes[pageName];\n                    if (node == null) {\n                        let path = `modules_${pageName}`.split('_').join('/');\n                        node = { action: this.createDefaultAction(path, this.loadjs), name: pageName };\n                        nodes[pageName] = node;\n                    }\n                    return node;\n                }\n            };\n            return p;\n        }\n        createDefaultAction(url, loadjs) {\n            return (page) => __awaiter(this, void 0, void 0, function* () {\n                let actionExports = yield loadjs(url);\n                if (!actionExports)\n                    throw Errors_1.Errors.exportsCanntNull(url);\n                let _action = actionExports.default;\n                if (_action == null) {\n                    throw Errors_1.Errors.canntFindAction(page.name);\n                }\n                let result;\n                if (PageMaster.isClass(_action)) {\n                    let action = _action;\n                    result = new action(page, this);\n                }\n                else {\n                    let action = _action;\n                    result = action(page, this);\n                }\n                return result;\n            });\n        }\n        loadjs(path) {\n            return new Promise((reslove, reject) => {\n                requirejs([path], function (result) {\n                    reslove(result);\n                }, function (err) {\n                    reject(err);\n                });\n            });\n        }\n        on_pageCreated(page) {\n            return this.pageCreated.fire(this, page);\n        }\n        get currentPage() {\n            if (this.page_stack.length > 0)\n                return this.page_stack[this.page_stack.length - 1];\n            return null;\n        }\n        getPage(pageUrl, values) {\n            if (!pageUrl)\n                throw Errors_1.Errors.argumentNull('pageUrl');\n            values = values || {};\n            let cachePage = this.cachePages[pageUrl];\n            if (cachePage != null) {\n                cachePage.data = values || {};\n                return { page: cachePage, isNew: false };\n            }\n            let page = this.createPage(pageUrl, values);\n            this.cachePages[pageUrl] = page;\n            this.on_pageCreated(page);\n            return { page, isNew: true };\n        }\n        createPage(pageUrl, values) {\n            if (!pageUrl)\n                throw Errors_1.Errors.argumentNull('pageUrl');\n            values = values || {};\n            let element = this.createPageElement(pageUrl);\n            let displayer = new this.pageDisplayType(this);\n            console.assert(this.pageType != null);\n            let page = new this.pageType({\n                app: this,\n                url: pageUrl,\n                data: values,\n                displayer,\n                element,\n            });\n            let showing = (sender) => {\n                this.pageShowing.fire(this, sender);\n            };\n            let shown = (sender) => {\n                this.pageShown.fire(this, sender);\n            };\n            page.showing.add(showing);\n            page.shown.add(shown);\n            page.closed.add(() => {\n                page.showing.remove(showing);\n                page.shown.remove(shown);\n            });\n            return page;\n        }\n        createPageElement(pageName) {\n            let element = document.createElement(Page_1.Page.tagName);\n            this.container.appendChild(element);\n            return element;\n        }\n        showPage(pageUrl, args, forceRender) {\n            args = args || {};\n            forceRender = forceRender == null ? false : true;\n            if (!pageUrl)\n                throw Errors_1.Errors.argumentNull('pageName');\n            if (this.currentPage != null && this.currentPage.url == pageUrl)\n                return this.currentPage;\n            let { page, isNew } = this.getPage(pageUrl, args);\n            if (isNew || forceRender) {\n                let action = this.findPageAction(pageUrl);\n                if (action == null)\n                    throw Errors_1.Errors.actionCanntNull(pageUrl);\n                action(page, this);\n            }\n            page.show();\n            this.pushPage(page);\n            console.assert(page == this.currentPage, \"page is not current page\");\n            return page;\n        }\n        closePage(page) {\n            if (page == null)\n                throw Errors_1.Errors.argumentNull('page');\n            page.close();\n            delete this.cachePages[page.url];\n            this.page_stack = this.page_stack.filter(o => o != page);\n        }\n        pushPage(page) {\n            this.page_stack.push(page);\n            if (this.page_stack.length > this.MAX_PAGE_COUNT) {\n                let page = this.page_stack.shift();\n                if (page)\n                    this.closePage(page);\n            }\n        }\n        findPageAction(pageUrl) {\n            let routeData = Application_1.parseUrl(pageUrl);\n            let pageName = routeData.pageName;\n            let node = this.findSiteMapNode(pageName);\n            if (node == null)\n                throw Errors_1.Errors.pageNodeNotExists(pageName);\n            let action = node.action;\n            if (action == null)\n                throw Errors_1.Errors.actionCanntNull(pageName);\n            return node.action;\n        }\n        findSiteMapNode(pageName) {\n            if (this.nodes[pageName])\n                return this.nodes[pageName];\n            let node = null;\n            let action = this.parser.actions ? this.parser.actions[pageName] : null;\n            if (action != null) {\n                node = { action, name: pageName };\n            }\n            if (node == null && this.parser.parse != null) {\n                node = this.parser.parse(pageName);\n                console.assert(node.action != null);\n            }\n            if (node != null)\n                this.nodes[pageName] = node;\n            return node;\n        }\n        closeCurrentPage(passData) {\n            var page = this.page_stack.pop();\n            if (page == null)\n                return;\n            this.closePage(page);\n            if (this.currentPage) {\n                if (passData) {\n                    console.assert(this.currentPage.data != null);\n                    this.currentPage.data = Object.assign(this.currentPage.data, passData);\n                }\n                this.currentPage.show();\n            }\n        }\n        get pageStack() {\n            return this.page_stack;\n        }\n    }\n    PageMaster.isClass = (function () {\n        var toString = Function.prototype.toString;\n        function fnBody(fn) {\n            return toString.call(fn).replace(/^[^{]*{\\s*/, '').replace(/\\s*}[^}]*$/, '');\n        }\n        function isClass(fn) {\n            return (typeof fn === 'function' &&\n                (/^class(\\s|\\{\\}$)/.test(toString.call(fn)) ||\n                    (/^.*classCallCheck\\(/.test(fnBody(fn)))));\n        }\n        return isClass;\n    })();\n    exports.PageMaster = PageMaster;\n});\n"],"file":"PageMaster.js"}