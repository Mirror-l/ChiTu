(function(n){typeof define=="function"&&define.amd?define(["jquery"],n):typeof module!="undefined"&&module.exports?module.exports=n(require(["jquery"])):window.chitu=n()})(function(){
/** @license
 * crossroads <http://millermedeiros.github.com/crossroads.js/>
 * Author: Miller Medeiros | MIT License
 * v0.12.0 (2013/01/21 13:47)
 */
var t=function(){function t(n,t){if(n.indexOf)return n.indexOf(t);for(var i=n.length;i--;)if(n[i]===t)return i;return-1}function e(n,i){var r=t(n,i);r!==-1&&n.splice(r,1)}function o(n,t){return"[object "+t+"]"===Object.prototype.toString.call(n)}function s(n){return o(n,"RegExp")}function l(n){return o(n,"Array")}function h(n){return typeof n=="function"}function r(n){return n===null||n==="null"?null:n==="true"?!0:n==="false"?!1:n===f||n==="undefined"?f:n===""||isNaN(n)?n:parseFloat(n)}function a(n){for(var t=n.length,i=[];t--;)i[t]=r(n[t]);return i}function v(n,t){for(var f=(n||"").replace("?","").split("&"),e=f.length,o={},i,u;e--;)i=f[e].split("="),u=t?r(i[1]):i[1],o[i[0]]=typeof u=="string"?decodeURIComponent(u):u;return o}function i(){this.bypassed=$.Callbacks();this.routed=$.Callbacks();this._routes=[];this._prevRoutes=[];this._piped=[];this.resetState()}function c(n,t,i,r){var u=s(n),f=r.patternLexer;this._router=r;this._pattern=n;this._paramsIds=u?null:f.getParamIds(n);this._optionalParamsIds=u?null:f.getOptionalParamsIds(n);this._matchRegexp=u?n:f.compilePattern(n,r.ignoreCase);this.matched=$.Callbacks();this.switched=$.Callbacks();t&&this.matched.add(t);this._priority=i||0}var n,u,f;return u=/t(.+)?/.exec("t")[1]==="",i.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0;this._prevMatchedRequest=null;this._prevBypassedRequest=null},create:function(){return new i},addRoute:function(n,t,i){var r=new c(n,t,i,this);return this._sortedInsert(r),r},removeRoute:function(n){e(this._routes,n);n._destroy()},removeAllRoutes:function(){for(var n=this.getNumRoutes();n--;)this._routes[n]._destroy();this._routes.length=0},parse:function(n,t){if(n=n||"",t=t||[],this.ignoreState||n!==this._prevMatchedRequest&&n!==this._prevBypassedRequest){var r=this._getMatchedRoutes(n),u=0,f=r.length,i;if(f)for(this._prevMatchedRequest=n,this._notifyPrevRoutes(r,n),this._prevRoutes=r;u<f;)i=r[u],i.route.matched.fire.apply(i.route.matched,t.concat(i.params)),i.isFirst=!u,this.routed.fire.apply(this.routed,t.concat([n,i])),u+=1;else this._prevBypassedRequest=n,this.bypassed.fire.apply(this.bypassed,t.concat([n]));this._pipeParse(n,t)}},_notifyPrevRoutes:function(n,t){for(var r=0,i;i=this._prevRoutes[r++];)i.route.switched&&this._didSwitch(i.route,n)&&i.route.switched.fire(t)},_didSwitch:function(n,t){for(var i,r=0;i=t[r++];)if(i.route===n)return!1;return!0},_pipeParse:function(n,t){for(var r=0,i;i=this._piped[r++];)i.parse(n,t)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(n){var t=this._routes,i=t.length;do--i;while(t[i]&&n._priority<=t[i]._priority);t.splice(i+1,0,n)},_getMatchedRoutes:function(n){for(var i=[],r=this._routes,u=r.length,t;t=r[--u];)if((!i.length||this.greedy||t.greedy)&&t.match(n)&&i.push({route:t,params:t._getParamsArray(n)}),!this.greedyEnabled&&i.length)break;return i},pipe:function(n){this._piped.push(n)},unpipe:function(n){e(this._piped,n)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},n=new i,n.VERSION="0.12.0",n.NORM_AS_ARRAY=function(n,t){return[t.vals_]},n.NORM_AS_OBJECT=function(n,t){return[t]},c.prototype={greedy:!1,rules:void 0,match:function(n){return n=n||"",this._matchRegexp.test(n)&&this._validateParams(n)},_validateParams:function(n){var i=this.rules,r=this._getParamsObject(n);for(var t in i)if(t!=="normalize_"&&i.hasOwnProperty(t)&&!this._isValidParam(n,t,r))return!1;return!0},_isValidParam:function(n,i,r){var u=this.rules[i],f=r[i],e=!1,o=i.indexOf("?")===0;return f==null&&this._optionalParamsIds&&t(this._optionalParamsIds,i)!==-1?e=!0:s(u)?(o&&(f=r[i+"_"]),e=u.test(f)):l(u)?(o&&(f=r[i+"_"]),e=this._isValidArrayRule(u,f)):h(u)&&(e=u(f,n,r)),e},_isValidArrayRule:function(n,i){if(!this._router.ignoreCase)return t(n,i)!==-1;typeof i=="string"&&(i=i.toLowerCase());for(var u=n.length,r,f;u--;)if(r=n[u],f=typeof r=="string"?r.toLowerCase():r,f===i)return!0;return!1},_getParamsObject:function(n){for(var h=this._router.shouldTypecast,o=this._router.patternLexer.getParamValues(n,this._matchRegexp,h),f={},e=o.length,s,i;e--;)i=o[e],this._paramsIds&&(s=this._paramsIds[e],s.indexOf("?")===0&&i&&(f[s+"_"]=i,i=v(i,h),o[e]=i),u&&i===""&&t(this._optionalParamsIds,s)!==-1&&(i=void 0,o[e]=i),f[s]=i),f[e]=i;return f.request_=h?r(n):n,f.vals_=o,f},_getParamsArray:function(n){var t=this.rules?this.rules.normalize_:null;return t=t||this._router.normalizeFn,t&&h(t)?t(n,this._getParamsObject(n)):this._getParamsObject(n).vals_},interpolate:function(n){var t=this._router.patternLexer.interpolate(this._pattern,n);if(!this._validateParams(t))throw new Error("Generated string doesn't validate against `Route.rules`.");return t},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.empty();this.switched.empty();this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},i.prototype.patternLexer=function(){function l(){var i,t;for(i in n)n.hasOwnProperty(i)&&(t=n[i],t.id="__CR_"+i+"__",t.save="save"in t?t.save.replace("{{id}}",t.id):t.id,t.rRestore=new RegExp(t.id,"g"))}function e(n,t){var i=[],r;for(n.lastIndex=0;r=n.exec(t);)i.push(r[1]);return i}function v(n){return e(r,n)}function y(t){return e(n.OP.rgx,t)}function p(n,r){return n=n||"",n&&(t===i?n=n.replace(h,""):t===f&&(n=n.replace(c,"")),n=o(n,"rgx","save"),n=n.replace(s,"\\$&"),n=o(n,"rRestore","res"),t===i&&(n="\\/?"+n)),t!==u&&(n+="\\/?"),new RegExp("^"+n+"$",r?"i":"")}function o(t,i,r){var u;for(var f in n)n.hasOwnProperty(f)&&(u=n[f],t=t.replace(u[i],u[r]));return t}function w(n,t,i){var r=t.exec(n);return r&&(r.shift(),i&&(r=a(r))),r}function b(t,i){if(typeof t!="string")throw new Error("Route pattern should be a string.");var u=function(n,t){var r,u,f;if(t=t.substr(0,1)==="?"?t.substr(1):t,i[t]!=null){if(typeof i[t]=="object"){u=[];for(f in i[t])u.push(encodeURI(f+"="+i[t][f]));r="?"+u.join("&")}else r=String(i[t]);if(n.indexOf("*")===-1&&r.indexOf("/")!==-1)throw new Error('Invalid value "'+r+'" for segment "'+n+'".');}else if(n.indexOf("{")!==-1)throw new Error("The segment "+n+" is required.");else r="";return r};return n.OS.trail||(n.OS.trail=new RegExp("(?:"+n.OS.id+")+$")),t.replace(n.OS.rgx,n.OS.save).replace(r,u).replace(n.OS.trail,"").replace(n.OS.rRestore,"/")}var s=/[\\.+*?\^$\[\](){}\/'#]/g,h=/^\/|\/$/g,c=/\/$/g,r=/(?:\{|:)([^}:]+)(?:\}|:)/g,n={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},i=1,u=2,f=3,t=i;return l(),{strict:function(){t=u},loose:function(){t=i},legacy:function(){t=f},getParamIds:v,getOptionalParamsIds:y,getParamValues:w,compilePattern:p,interpolate:b}}(),window.crossroads=n,n},n;return window.crossroads=t(window.jQuery),function(n){var t=n.Errors,i=function(){function n(){}return n.isType=function(n,t){for(var i in n.prototype)if(t[i]===undefined)return!1;return!0},n.isDeferred=function(n){return n==null?!1:n.pipe!=null&&n.always!=null&&n.done!=null?!0:!1},n.format=function(n,t,i,r,u,f,e,o,s,h,c){for(var a=[t,i,r,u,f,e,o,s,h,c],l=0;l<a.length;l++){if(a[l]==null)break;n=n.replace(new RegExp("\\{"+l+"\\}","g"),function(){return a[l]})}return n},n.fileName=function(n,i){var r,u;if(!n)throw t.argumentNull("url");return i=i||!0,n=n.replace("http://","/"),r=n.replace(/^.*[\\\/]/,""),i===!0&&(u=r.split("."),r=u[0]),r},n.log=function(n,t){if(t===void 0&&(t=[]),window.console){if(t==null){console.log(n);return}var i=this.format.apply(this,arguments);console.log(i)}},n}();n.Utility=i}(n||(n={})),function(n){var t=n.Utility,i=function(){function n(){}return n.argumentNull=function(n){var i=t.format('The argument "{0}" cannt be null.',n);return new Error(i)},n.modelFileExpecteFunction=function(n){var i=t.format('The eval result of script file "{0}" is expected a function.',n);return new Error(i)},n.paramTypeError=function(n,i){var r=t.format('The param "{0}" is expected "{1}" type.',n,i);return new Error(r)},n.viewNodeNotExists=function(n){var i=t.format('The view node "{0}" is not exists.',n);return new Error(i)},n.pathPairRequireView=function(n){var i=t.format('The view value is required for path pair, but the item with index "{0}" is miss it.',n);return new Error(i)},n.notImplemented=function(n){var i=t.format('The method "{0}" is not implemented.',n);return new Error(i)},n.routeExists=function(n){var i=t.format('Route named "{0}" is exists.',n);return new Error(i)},n.routeResultRequireController=function(n){var i=t.format('The parse result of route "{0}" does not contains controler.',n);return new Error(i)},n.routeResultRequireAction=function(n){var i=t.format('The parse result of route "{0}" does not contains action.',n);return new Error(i)},n.ambiguityRouteMatched=function(n,i,r){var u=t.format("Ambiguity route matched, {0} is match in {1} and {2}.",n,i,r);return new Error(u)},n.noneRouteMatched=function(n){var i=t.format('None route matched with url "{0}".',n);return new Error(i)},n.emptyStack=function(){return new Error("The stack is empty.")},n.canntParseUrl=function(n){var i=t.format('Can not parse the url "{0}" to route data.',n);return new Error(i)},n.routeDataRequireController=function(){return new Error('The route data does not contains a "controller" file.')},n.routeDataRequireAction=function(){return new Error('The route data does not contains a "action" file.')},n.parameterRequireField=function(n,i){var r=t.format("Parameter {1} does not contains field {0}.",n,i);return new Error(r)},n}();n.Errors=i}(n||(n={})),function(n){function u(n){var t=i[n]={};return jQuery.each(n.match(r)||[],function(n,i){t[i]=!0}),t}function e(t){t===void 0&&(t=null);t=typeof t=="string"?i[t]||u(t):jQuery.extend({},t);var e,l,h,a,o,s,r=[],f=!t.once&&[],v=function(n){for(e=t.memory&&n,l=!0,s=a||0,a=0,o=r.length,h=!0;r&&s<o;s++){var i=r[s].apply(n[0],n[1]);if(i!=null&&n[0].results.push(i),i===!1&&t.stopOnFalse){e=!1;break}}h=!1;r&&(f?f.length&&v(f.shift()):e?r=[]:c.disable())},c={results:[],add:function(){if(r){var n=r.length;(function i(n){jQuery.each(n,function(n,u){var f=jQuery.type(u);f==="function"?t.unique&&c.has(u)||r.push(u):u&&u.length&&f!=="string"&&i(u)})})(arguments);h?o=r.length:e&&(a=n,v(e))}return this},remove:function(){return r&&jQuery.each(arguments,function(n,t){for(var i;(i=jQuery.inArray(t,r,i))>-1;)r.splice(i,1),h&&(i<=o&&o--,i<=s&&s--)}),this},has:function(n){return n?jQuery.inArray(n,r)>-1:!!(r&&r.length)},empty:function(){return r=[],o=0,this},disable:function(){return r=f=e=undefined,this},disabled:function(){return!r},lock:function(){return f=undefined,e||c.disable(),this},locked:function(){return!f},fireWith:function(n,t){return n.results=[],r&&(!l||f)&&(t=t||[],t=[n,t.slice?t.slice():t],h?f.push(t):v(t)),n.results},fire:function(){return c.fireWith(this,arguments)},fired:function(){return!!l},count:function(){return r.length}};return new n.Callback(c)}function o(t,i){for(var u=t.fire.apply(t,i),f=[],r=0;r<u.length;r++)n.Utility.isDeferred(u[r])&&f.push(u[r]);return f.length==0?$.Deferred().resolve():$.when.apply($,f)}var r=/\S+/g,i={},f=function(){function n(n){this.source=n}return n.prototype.add=function(n){this.source.add(n)},n.prototype.remove=function(n){this.source.remove(n)},n.prototype.has=function(n){return this.source.has(n)},n.prototype.fireWith=function(n,t){return this.source.fireWith(n,t)},n.prototype.fire=function(n,t,i){return this.source.fire(n,t,i)},n}(),t;n.Callback=f;n.Callbacks=e;n.fireCallback=o;t=window.crossroads;$.extend(t,{_create:t.create,create:function(){var t=this._create();return t.getRouteData=function(t,i){if(t=t||"",i=i||[],this.ignoreState||t!==this._prevMatchedRequest&&t!==this._prevBypassedRequest){var r=this._getMatchedRoutes(t),u=r.length;if(u==0)return null;if(u>1)throw n.Errors.ambiguityRouteMatched(t,"route1","route2");return r[0]}},t}})}(n||(n={})),function(n){var t=n,i=n.Errors,r=function(){function n(n,i){this.pageCreating=t.Callbacks();this.pageCreated=t.Callbacks();this.pageShowing=t.Callbacks();this.pageShown=t.Callbacks();this.init(n,i)}return n.prototype.init=function(n,t){this._app=n;this._node=t;this._pageStack=[]},n.prototype.on_pageCreating=function(n){return t.fireCallback(this.pageCreating,[this,n])},n.prototype.on_pageCreated=function(n){return t.fireCallback(this.pageCreated,[this,n])},n.prototype.on_pageShowing=function(n,i){return t.fireCallback(this.pageShowing,[this,n,i])},n.prototype.on_pageShown=function(n,i){return t.fireCallback(this.pageShown,[this,n,i])},n.prototype.application=function(){return this._app},n.prototype.node=function(){return this._node},n.prototype.currentPage=function(){return this._currentPage},n.prototype._createPage=function(n,r){var u,f;if(!n)throw i.argumentNull("url");if(typeof n!="string")throw i.paramTypeError("url","String");if(r||(r=document.createElement("div"),document.body.appendChild(r)),u=this.application().routes().getRouteData(n),u==null)throw i.noneRouteMatched(n);var h=u.values().controller,c=u.values().action,o=this.application().controller(u),s=this.application().viewFactory.view(u),e=new t.ControllerContext(o,s,u);this.on_pageCreating(e);f=new t.Page(e,r);this.on_pageCreated(f);return f},n.prototype.showPage=function(n,t){var f,r,l,h,e,o;if(t=t||{},!n)throw i.argumentNull("url");if(f=this.application().routes().getRouteData(n),f==null)throw i.noneRouteMatched(n);var s=this.node(),a=f.values().controller,v=f.values().action,c=a+"."+v,u=$(s).data("pages");u||(u={},$(s).data("pages",u));e=this;r=u[c];r==null&&(l=$("<div>").appendTo(s)[0],r=this._createPage(n,l),u[c]=r);this._currentPage=r;for(h in u)u[h]!=this._currentPage&&u[h].visible(!1);return $.extend(t,f.values()),e=this,o=$.Deferred(),this.on_pageShowing(r,t).pipe(function(){return r.open(t)}).done($.proxy(function(){e._pageStack.push({page:this.page,url:this.url});this.page!=e.currentPage()&&this.page.visible(!1);this.result.resolve(this.page);e.on_pageShown(this.page,t)},{page:r,result:o,url:n})).fail($.proxy(function(n){this.result.reject(this.page,n)},{page:r,result:o,url:n})),o},n.prototype.back=function(n){var i=this._pageStack,r=this.currentPage(),t,u;return i.length==0||r==null?$.Deferred().reject():(i.pop(),t=i[i.length-1],t==null)?$.Deferred().reject():(u="#"+t.url.toLowerCase(),u.localeCompare(window.location.hash.toLowerCase())!=0&&(window.location.hash=t.url,window.location.skip=!0),r.visible(!1),n?t.page.open(n):t.page.visible(!0),this._currentPage=t.page,$.Deferred().resolve())},n}();n.PageContainer=r}(n||(n={})),function(n){function i(t,i,r){return r===void 0&&(r={}),n.fireCallback(t,[i,r])}var t=n,f=n.Utility,r=n.Errors,c="page-node",l="page-header",e="page-body",a="page-footer",v="page-loading",o,u,s,h;(function(n){n[n.swipeLeft=0]="swipeLeft";n[n.swipeRight=1]="swipeRight";n[n.none=2]="none"})(o||(o={})),function(n){n[n.open=0]="open";n[n.closed=1]="closed"}(u||(u={}));s=function(){function n(n){n.className=c;this.node=n;this.headerNode=document.createElement("div");this.headerNode.className=l;n.appendChild(this.headerNode);this.bodyNode=document.createElement("div");this.bodyNode.className=e;n.appendChild(this.bodyNode);this.loadingNode=document.createElement("div");this.loadingNode.className=v;this.loadingNode.innerHTML='<div class="loading-form"><i class="icon-spinner icon-3x icon-spin"><\/i><\/div>';n.appendChild(this.loadingNode);this.footerNode=document.createElement("div");this.footerNode.className=a;n.appendChild(this.footerNode)}return n}();h=function(){function n(i,u){var f;if(this._loadViewModelResult=null,this._openResult=null,this._hideResult=null,this.swipe=!0,this.init=t.Callbacks(),this.preLoad=t.Callbacks(),this.load=t.Callbacks(),this.closing=t.Callbacks(),this.closed=t.Callbacks(),this.scroll=t.Callbacks(),this.showing=t.Callbacks(),this.shown=t.Callbacks(),this.hiding=t.Callbacks(),this.hidden=t.Callbacks(),!i)throw r.argumentNull("context");if(!u)throw r.argumentNull("container");this.container=u;f=document.createElement("div");u.appendChild(f);this._context=i;var c=i.routeData().values().controller,l=i.routeData().values().action,e=n.getPageName(i.routeData()),o=i.view(),h=i.controller().action(i.routeData());this.pageNode=new s(f);this._init(e,o,h,f)}return n.getPageName=function(n){var t,i;return n.pageName()?(i=window.crossroads.addRoute(n.pageName()),t=i.interpolate(n.values())):t=n.values().controller+"."+n.values().action,t},n.prototype.context=function(){return this._context},n.prototype.name=function(){return this._name},n.prototype.node=function(){return this.pageNode.node},n.prototype.hide=function(){this.hidePageNode();this.on_hidden({})},n.prototype.show=function(){this.on_showing({});this.showPageNode();this.on_shown({})},n.prototype.hidePageNode=function(){if(this.swipe){var i=$(this.container).width(),n=this,t=1e3;window.move(this.node()).set("left",i+"px").duration(t).end();window.setTimeout(function(){n.node().style.display="none";n.on_hidden({})},t)}else $(this.node()).hide()},n.prototype.showPageNode=function(n){var r,t,i;n===void 0&&(n=undefined);n?(r=$(this.container).width(),this.node().style.left=r+"px",this.node().style.display="block",t=this,i=1e3,window.setTimeout(function(){window.move(t.node()).set("left","0px").duration(i).end()},10),window.setTimeout(function(){t.on_shown({})},i)):this.node().style.display="block"},n.prototype.showBodyNode=function(){$(this.pageNode.node).show();$(this.pageNode.loadingNode).hide();$(this.pageNode.bodyNode).show()},n.prototype.showLoadingNode=function(){$(this.pageNode.node).show();$(this.pageNode.bodyNode).hide();$(this.pageNode.loadingNode).show()},n.prototype._init=function(n,t,i,u){if(!n)throw r.argumentNull("name");if(!t)throw r.argumentNull("viewDeferred");if(!i)throw r.argumentNull("actionDeferred");if(!u)throw r.argumentNull("node");this._name=n;this._viewDeferred=t;this._actionDeferred=i},n.prototype.on_init=function(){return i(this.init,this)},n.prototype.on_load=function(n){return i(this.load,this,n)},n.prototype.on_closed=function(n){return i(this.closed,this,n)},n.prototype.on_scroll=function(n){return i(this.scroll,this,n)},n.prototype.on_showing=function(n){return i(this.showing,this,n)},n.prototype.on_shown=function(n){return i(this.shown,this,n)},n.prototype.on_hiding=function(n){return i(this.hiding,this,n)},n.prototype.on_hidden=function(n){return i(this.hidden,this,n)},n.prototype._loadViewModel=function(){if(this._loadViewModelResult)return this._loadViewModelResult;var n=this;return this._loadViewModelResult=this._viewDeferred.pipe(function(t){return f.log("Load view success, page:{0}.",[n._name]),$(n.node()).find("."+e).html(t),n._actionDeferred}).pipe(function(t){var i=t.execute(n);return(n.on_init(),f.isDeferred(i))?i:$.Deferred().resolve()}).fail(function(){n._loadViewModelResult=null;f.log("Load view or action fail, page：{0}.",[n._name])}),this._loadViewModelResult},n.prototype.open=function(n,t){if(t===void 0&&(t=undefined),this._openResult)return this._openResult;this.status=u.open;var i=this;i.on_showing(n);return t=!0,t&&i.showPageNode(t),i.showLoadingNode(),this._openResult=i._loadViewModel().pipe(function(){return i.on_load(n)}),this._openResult.done($.proxy(function(){i.showBodyNode();i.on_shown(this.args)},{args:n})),this._openResult.always(function(){i._openResult=null})},n.prototype.close=function(n){n===void 0&&(n=undefined);this._openResult!=null&&this._openResult.reject({message:"close"});var t=this;t.hidePageNode();t.on_closed(n);this.status=u.closed},n}();n.Page=h}(n||(n={})),function(n){function e(n,t){var u="http://".toLowerCase(),i,r;return n.substr(0,u.length).toLowerCase()==u?(i=document.createElement("a"),i.setAttribute("href",n),n=decodeURI(i.pathname),r=f.addRoute(n),u+i.host+r.interpolate(t)):(r=f.addRoute(n),r.interpolate(t))}function s(n,i,r){var u;switch(arguments.length){case 0:throw t.argumentNull("func");case 1:if(typeof arguments[0]!="function")throw t.paramTypeError("arguments[0]","Function");r=n;i=n=[];break;case 2:if(r=i,typeof r!="function")throw t.paramTypeError("func","Function");if(!$.isArray(n))throw t.paramTypeError("deps","Array");n.length==0?n=i=[]:typeof n[0]=="function"?(i=n,n=[]):i=[]}for(u=0;u<n.length;u++)if(typeof n[u]!="string")throw t.paramTypeError("deps["+u+"]","string");for(u=0;u<i.length;u++)if(typeof i[u]!="function")throw t.paramTypeError("filters["+u+"]","function");if(!$.isFunction(r))throw t.paramTypeError("func","function");return define(n,$.proxy(function(){var n=Array.prototype.slice.call(arguments,0),t=this.func,i=this.filters;return{func:function(i){return n.unshift(i),t.apply(t,n)},filters:i}},{func:r,filters:i})),r}var r=n,t=r.Errors,u=r.Utility,f=window.crossroads,o=function(){function f(t){this._actions={};this._name=t;this._actions={};this.actionCreated=n.Callbacks()}return f.prototype.name=function(){return this._name},f.prototype.action=function(n){var r=n.values().controller,i,u;if(!r)throw t.routeDataRequireController();if(this._name!=r)throw new Error("Not same a controller.");if(i=n.values().action,!i)throw t.routeDataRequireAction();return u=this,this._actions[i]||(this._actions[i]=this._createAction(n).fail($.proxy(function(){u._actions[this.actionName]=null},{actionName:n}))),this._actions[i]},f.prototype._createAction=function(n){var o=n.values().action;if(!o)throw t.routeDataRequireAction();var f=this,h=e(n.actionPath(),n.values()),s=$.Deferred();return requirejs([h],$.proxy(function(n){var t,e;if(n||(console.warn(u.format("加载活动“{1}.{0}”失败，为该活动提供默认的值。",this.actionName,f.name())),n={func:function(){}}),t=n.func||n,!$.isFunction(t))throw r.Errors.modelFileExpecteFunction(this.actionName);e=new i(f,this.actionName,t);f.actionCreated.fire(f,e);this.result.resolve(e)},{actionName:o,result:s}),$.proxy(function(){console.warn(u.format("加载活动“{1}.{0}”失败，为该活动提供默认的值。",this.actionName,f.name()));var n=new i(f,this.actionName,function(){});f.actionCreated.fire(f,n);this.result.resolve(n)},{actionName:o,result:s})),s},f}(),i;n.Controller=o;i=function(){function n(n,i,r){if(!n)throw t.argumentNull("controller");if(!i)throw t.argumentNull("name");if(!r)throw t.argumentNull("handle");if(!$.isFunction(r))throw t.paramTypeError("handle","Function");this._name=i;this._handle=r}return n.prototype.name=function(){return this._name},n.prototype.execute=function(n){if(!n)throw t.argumentNull("page");var i=this._handle.apply({},[n]);return u.isDeferred(i)?i:$.Deferred().resolve()},n}();n.Action=i;n.action=s}(n||(n={})),function(n){var t=function(){function t(t,i,r){this._routeData=new n.RouteData;this._controller=t;this._view=i;this._routeData=r}return t.prototype.controller=function(){return this._controller},t.prototype.view=function(){return this._view},t.prototype.routeData=function(){return this._routeData},t}();n.ControllerContext=t}(n||(n={})),function(n){var t=n.Errors,i=n,r=function(){function n(){this._controllers={};this._controllers={}}return n.prototype.controllers=function(){return this._controllers},n.prototype.createController=function(n){return new i.Controller(n)},n.prototype.actionLocationFormater=function(){return this._actionLocationFormater},n.prototype.getController=function(n){if(!n.values().controller)throw t.routeDataRequireController();return this._controllers[n.values().controller]||(this._controllers[n.values().controller]=this.createController(n.values().controller)),this._controllers[n.values().controller]},n}();n.ControllerFactory=r}(n||(n={})),function(n){var t=function(){function n(n,t,i){this._name=n;this._pattern=t;this._defaults=i}return n.prototype.name=function(){return this._name},n.prototype.defaults=function(){return this._defaults},n.prototype.url=function(){return this._pattern},n}();n.Route=t}(n||(n={})),function(n){var r=n,t=n.Errors,i=function(){function i(){this._init()}return i.prototype._init=function(){var n=window.crossroads;this._source=n.create();this._source.ignoreCase=!0;this._source.normalizeFn=n.NORM_AS_OBJECT;this._priority=0},i.prototype.count=function(){return this._source.getNumRoutes()},i.prototype.mapRoute=function(i){var r,f;i=i||{};var e=i.name,u=i.url,o=i.defaults,s=i.rules||{};if(!e)throw t.argumentNull("name");if(!u)throw t.argumentNull("url");if(this._priority=this._priority+1,r=new n.Route(e,u,o),r.viewPath=i.viewPath,r.actionPath=i.actionPath,f=this._source.addRoute(u,function(){},this._priority),f.rules=s,f.newRoute=r,this._defaultRoute==null){if(this._defaultRoute=r,this._defaultRoute.viewPath==null)throw new Error("default route require view path.");if(this._defaultRoute.actionPath==null)throw new Error("default route require action path.");}return r.viewPath=r.viewPath||this._defaultRoute.viewPath,r.actionPath=r.actionPath||this._defaultRoute.actionPath,r},i.prototype.getRouteData=function(i){var r=this._source.getRouteData(i),e,o,f,s,u;if(r==null)throw t.canntParseUrl(i);for(e={},o=r.route._paramsIds||[],f=0;f<o.length;f++)s=o[f],e[s]=r.params[0][s];return u=new n.RouteData,u.values(e),u.actionPath(r.route.newRoute.actionPath),u.viewPath(r.route.newRoute.viewPath),u},i.defaultRouteName="default",i}();n.RouteCollection=i}(n||(n={})),function(n){var t=function(){function n(){}return n.prototype.values=function(n){return n===void 0&&(n=undefined),n!==undefined&&(this._values=n),this._values},n.prototype.viewPath=function(n){return n===void 0&&(n=undefined),n!==undefined&&(this._viewPath=n),this._viewPath},n.prototype.actionPath=function(n){return n===void 0&&(n=undefined),n!==undefined&&(this._actionPath=n),this._actionPath},n.prototype.pageName=function(n){return n===void 0&&(n=undefined),n!==undefined&&(this._pageName=n),this._pageName},n}();n.RouteData=t}(n||(n={})),function(n){function r(n,t){var f="http://".toLowerCase(),r,u;return n.substr(0,f.length).toLowerCase()==f?(r=document.createElement("a"),r.setAttribute("href",n),n=decodeURI(r.pathname),u=i.addRoute(n),f+r.host+u.interpolate(t)):(u=i.addRoute(n),u.interpolate(t))}var t=n.Errors,i=window.crossroads,u=function(){function n(){this._views=[]}return n.prototype.view=function(n){var f;if(!n.values().controller)throw t.routeDataRequireController();if(!n.values().action)throw t.routeDataRequireAction();var u=r(n.viewPath(),n.values()),e=this,i=n.values().controller+"_"+n.values().action;return this._views[i]||(this._views[i]=$.Deferred(),f="http://",u.substr(0,f.length).toLowerCase()==f?$.ajax({url:u}).done($.proxy(function(n){n!=null?this.deferred.resolve(n):this.deferred.reject()},{deferred:this._views[i]})).fail($.proxy(function(n){this.deferred.reject(n)},{deferred:this._views[i]})):requirejs(["text!"+u],$.proxy(function(n){n!=null?this.deferred.resolve(n):this.deferred.reject()},{deferred:this._views[i]}),$.proxy(function(n){this.deferred.reject(n)},{deferred:this._views[i]}))),this._views[i]},n}();n.ViewFactory=u}(n||(n={})),function(n){var i=n,r=n.Utility,t=n.Errors,u=function(){function u(r){if(this.pageCreating=i.Callbacks(),this.pageCreated=i.Callbacks(),this.pages={},this._routes=new n.RouteCollection,this._runned=!1,this.controllerFactory=new n.ControllerFactory,this.viewFactory=new n.ViewFactory,r==null)throw t.argumentNull("container");if(!r.container)throw new Error("The config has not a container property.");if(!$.isFunction(r.container)&&!r.container.tagName)throw new Error("Parameter container is not a function or html element.");this._container=r.container}return u.prototype.on_pageCreating=function(n){return i.fireCallback(this.pageCreating,[this,n])},u.prototype.on_pageCreated=function(n){return i.fireCallback(this.pageCreated,[this,n])},u.prototype.routes=function(){return this._routes},u.prototype.controller=function(n){if(typeof n!="object")throw t.paramTypeError("routeData","object");if(!n)throw t.argumentNull("routeData");return this.controllerFactory.getController(n)},u.prototype.currentPage=function(){return this._currentPage},u.prototype.action=function(n){var r,i,u;if(typeof n!="object")throw t.paramTypeError("routeData","object");if(!n)throw t.argumentNull("routeData");if(r=n.controller,!r)throw t.argumentNull("name");if(typeof r!="string")throw t.routeDataRequireController();if(i=n.action,!i)throw t.argumentNull("name");if(typeof i!="string")throw t.routeDataRequireAction();return u=this.controller(n),u.action(i)},u.prototype.run=function(){if(!this._runned){var n=this,t=function(){var t=window.location.hash,i,u;if(!t){r.log("The url is not contains hash.");return}i=window.location.arguments||{};u=window.location.container||n._container;window.location.arguments=null;window.location.container=null;(window.location.skip==null||window.location.skip==!1)&&n.showPage(t.substr(1),i);window.location.skip=!1};$.proxy(t,this)();$(window).bind("hashchange",$.proxy(t,this));this._runned=!0}},u.prototype.showPage=function(i,r){var u,e,c,h;if(r=r||{},!i)throw t.argumentNull("url");if(u=this.routes().getRouteData(i),u==null)throw t.noneRouteMatched(i);if($.isFunction(this._container)){if(e=this._container(u.values()),e==null)throw new Error("The result of continer function cannt be null");}else e=this._container;var l=u.values().controller,a=u.values().action,o=n.Page.getPageName(u),s=this.pages,c=this,f=s[o];return f==null&&(f=this._createPage(i,e),s[o]=f),this.previousPage=this._currentPage,this._currentPage=f,this.previousPage&&this.previousPage.close(),$.extend(r,u.values()),c=this,h=$.Deferred(),f.open(r).fail($.proxy(function(n){this.result.reject(this.page,n)},{page:f,result:h,url:i}))},u.prototype.createPageNode=function(){return document.createElement("div")},u.prototype._createPage=function(n,r){var u,f;if(!n)throw t.argumentNull("url");if(!r)throw t.argumentNull("element");if(u=this.routes().getRouteData(n),u==null)throw t.noneRouteMatched(n);var h=u.values().controller,c=u.values().action,o=this.controller(u),s=this.viewFactory.view(u),e=new i.ControllerContext(o,s,u);this.on_pageCreating(e);f=new i.Page(e,r);this.on_pageCreated(f);return f},u.prototype.redirect=function(n,t){t===void 0&&(t={});window.location.arguments=t;window.location.hash=n},u.prototype.back=function(n){return(n===void 0&&(n=undefined),window.history.length==0)?$.Deferred().reject():(window.history.back(),$.Deferred().resolve())},u}();n.Application=u}(n||(n={})),window.chitu=n,n});
//# sourceMappingURL=chitu.min.js.map
